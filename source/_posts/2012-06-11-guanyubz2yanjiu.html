---
layout: post
title: 关于cmd研究
categories:
- linux基础
- python模块研究
tags:
- cmd
published: true
comments: true
indexer: true
---
<p>前言：cmd模块创建面向行的命令处理器</p>

<p><strong>1 例子：</strong></p>

<p><pre class="sh_python">
import cmd</p>

<p>class HelloWorld(cmd.Cmd):
    def do_exhello(self, line):  #设置一个命令，其中，这个命令就是‘do_’后面的字符串，这里，这个命令就是exhello
        print "hello"</p>

<p>    def do_EOF(self, line):  #设置一个结束方法，这里返回true表示程序退出
        return True
if __name__ == '__main__':
    HelloWorld().cmdloop()
</pre></p>

<p>执行过程：</p>

<p>dongwm@linux-dongwm:~&gt; python test.py  #启动程序
(Cmd) help   #进入cmd模式，输入‘help’
Undocumented commands:
======================
EOF  exhello  help  #显示目前有三个命令可用</p>

<p>(Cmd) exhello  #执行我们自定义的命令
hello  #执行这个命令的方法
(Cmd) testcmd  #不存在这个命令，报错
*** Unknown syntax: testcmd
(Cmd) dongwm@linux-dongwm:~&gt; #退出</p>

<p><strong>2 例子（命令带参数）：</strong></p>

<p><pre class="sh_python">
import cmd
class HelloWorld(cmd.Cmd):
    def do_exhello(self, person):
        """exhello [person]   #这个方法注释就是显示这个命令帮助的信息
        Greet the named person"""
        if person:
            print "hi,", person
        else:
            print 'hi'
    def do_EOF(self, line):
        return True
if __name__ == '__main__':
    HelloWorld().cmdloop()
</pre></p>

<p>执行过程：</p>

<p>dongwm@linux-dongwm:~&gt; python test.py
(Cmd) help</p>

<p>Documented commands (type help &lt;topic&gt;):
========================================
exhello</p>

<p>Undocumented commands:
======================
EOF  help</p>

<p>(Cmd) help exhello   #显示命令的帮助
exhello [person]
Greet the named person
(Cmd) exhello dongwm
hi, dongwm
(Cmd) exhello
hi
<strong>注：上面的例子，也可以不实用方法的注释作为帮助信息，可以定义一个方法名字是：'help_' + 这个命令</strong></p>

<p><pre class="sh_python">
class HelloWorld(cmd.Cmd):
    def do_exhello(self, person):
        if person:
            print "hi,", person
        else:
            print 'hi'
    def help_exhello(self):  #注意这个方法
        print '\n'.join([ 'greet [person]',
                           'Greet the named person',])
    def do_EOF(self, line):
        return True
if __name__ == '__main__':
    HelloWorld().cmdloop()
</pre></p>

<p><strong>3 实现命令的tab自动补全，其实还是给命令添加一个方法：'complete_' + 命令名字</strong></p>

<p><pre class="sh_python">
import cmd
class HelloWorld(cmd.Cmd):
    FRIENDS = [ 'ailll', 'dongwm' ]  #设置一个命令提示的数据范围，这里有这2个字符串
    def do_exhello(self, person):
        if person:
            print "hi,", person
        else:
            print 'hi'
    def complete_exhello(self, text, line, begidx, endidx):  #自动补全的方法
        if not text:  #当没有设置时候 打印所有可选的字符串
            completions = self.FRIENDS[:]
        else:  
            completions = [ f
                            for f in self.FRIENDS
                            if f.startswith(text)
                            ]  #假如输入的字母符合那个提供的字符串列表中的某项开头，打印之
        return completions
    def do_EOF(self, line):
        return True
if __name__ == '__main__':
    HelloWorld().cmdloop()
</pre></p>

<p>执行过程：</p>

<p>dongwm@linux-dongwm:~&gt; python test.py
(Cmd) &lt;tab&gt;&lt;tab&gt; #2下‘tab’自动输出全部命令
EOF      exhello  help
(Cmd) exhello dongwm #在输入ex，按&lt;tab&gt;自动补全exhello ，然后空格，输入字母'd'，因为符合列表中的'dongwm'，自动补全
hi, dongwm
(Cmd)
<strong>4 通过属性配置CMD</strong></p>

<p><pre class="sh_python">
import cmd
class HelloWorld(cmd.Cmd):
    prompt = 'prompt: '   #设置最开始的提示符
    intro = "Simple command processor example."  #一个欢迎的旗标，执行cmd后自动打印出来
    doc_header = 'doc_header'
    misc_header = 'misc_header'
    undoc_header = 'undoc_header'
    ruler = '-'
    def do_prompt(self, line):
        "Change the interactive prompt"  #当执行prompt这个命令，修改提示符
        self.prompt = line + ': '</p>

<p>    def do_EOF(self, line):
        return True
if __name__ == '__main__':
    HelloWorld().cmdloop()
</pre></p>

<p>执行过程：</p>

<p>dongwm@linux-dongwm:~&gt; python test.py
Simple command processor example.  #一开始打印旗标
prompt: prompt test #使用prompt命令修改标识
test: help  #表示变成'test:' 执行help命令
doc_header
----------
prompt
undoc_header
------------
EOF  help
test:</p>

<p><strong>5类似于shell的历史记录，比如使用? !</strong></p>

<p>注：'?'相当于内置的help，'!'相当于象以前一样使用这个命令</p>

<p><pre class="sh_python">
import cmd
import os</p>

<p>class ShellEnabled(cmd.Cmd):
    last_output = ''
    def do_shell(self, line):
        print "running shell command:", line
        output = os.popen(line).read()  #相当与启动一个新shell操作
        print output
        self.last_output = output
    def do_echo(self, line):
        "Print the input, replacing '$out' with the output of the last shell command"
        print line.replace('$out', self.last_output)
    def do_EOF(self, line):
        return True
if __name__ == '__main__':
    ShellEnabled().cmdloop()
</pre></p>

<p>执行过程：</p>

<p>dongwm@linux-dongwm:~&gt; python test.py
(Cmd) ?</p>

<p>Documented commands (type help &lt;topic&gt;):
========================================
echo  #因为这个命令指定了方法的描述</p>

<p>Undocumented commands:
======================
EOF  help  shell</p>

<p>(Cmd) ?echo  #因为以前没有用过命令，还不存在
Print the input, replacing '$out' with the output of the last shell command
(Cmd) shell pwd  #执行shell  打印当前目录
running shell command: pwd
/home/dongwm</p>

<p>(Cmd) !pwd  #执行上一个命令shell，还是打印当前目录
running shell command: pwd
/home/dongwm</p>

<p>(Cmd) echo $out  #现在$out存在了
/home/dongwm</p>

<p>&nbsp;</p>
