---
layout: post
title: 关于ConfigParser研究
categories:
- python模块研究
tags:
- ConfigParser
- SafeConfigParser
published: true
comments: true
indexer: true
---
<p>前言：ConfigParser很经常使用，主要是解析和修改类似于windows的ini文件的模块。，配置项使用［］，每个具体项为 key=value，这里有个配置例子(test.cfg)：
<pre class="sh_ini">
[test]
url = http://localhost:8080
username = dongwm
password = passwd
</pre>
<pre class="sh_python">
from ConfigParser import SafeConfigParser  #建议不要用子类ConfigParser
parser = SafeConfigParser()
parser.read('test.cfg')  #加载要分析的配置文件
print parser.get('test', 'url')  #获取 test 端 key为‘url’的值
</pre>
注：read（）支持多个配置文件：
<pre class="sh_python">
from ConfigParser import SafeConfigParser
parser = SafeConfigParser()
list = ['does_not_exist.cfg', 'also-does-not-exist.cfg','test.cfg' ]
found = parser.read(list)</p>

<p>missing = set(list) - set(found)</p>

<p>print 'Found config files:', sorted(found)
print 'Missing files     :', sorted(missing)
</pre>
dongwm@linux-dongwm:~&gt; python test.py
Found config files: ['test.cfg']
Missing files     : ['also-does-not-exist.cfg', 'does_not_exist.cfg']
注2：假如配置文件有其他不可被直接识别的字符呢：
dongwm@linux-dongwm:~&gt; cat !$
cat test.cfg
[test]
url = http://localhost:8080
username = dongwm
password = ßéç®é†
<pre class="sh_python">
from ConfigParser import SafeConfigParser
import codecs</p>

<p>parser = SafeConfigParser()</p>

<p>with codecs.open('test.cfg', 'r', encoding='utf-8') as f:
    parser.readfp(f)</p>

<p>password = parser.get('test', 'password')</p>

<p>print 'Password:', password.encode('utf-8')
print 'Type    :', type(password)
print 'repr()  :', repr(password)
</pre>
执行结果：
dongwm@linux-dongwm:~&gt; python test.py
Password: ßéç®é†
Type    : &lt;type 'unicode'&gt;
repr()  : u'\xdf\xe9\xe7\xae\xe9\u2020'
<pre class="sh_python">
from ConfigParser import SafeConfigParser</p>

<p>parser = SafeConfigParser()
parser.read('test.cfg')</p>

<p>for candidate in [ 'test-1', 'test' ]:
    print '%-12s: %s' % (candidate, parser.has_section(candidate))  #has_section 判断是不是有这个setion 没有为 false
</pre>
dongwm@linux-dongwm:~&gt; python test.py
test-1      : False
test        : True</p>

<p><pre class="sh_python">
import ConfigParser
import sys
parser = ConfigParser.SafeConfigParser()</p>

<p>parser.add_section('test')  #添加一个setion
parser.set('test', 'url', 'http://localhost:8080')
parser.set('test', 'username', 'dongwm')
parser.set('test', 'password', 'passwd')</p>

<p>for section in parser.sections():
    print section
    for name, value in parser.items(section):
        print '  %s = %r' % (name, value)
parser.remove_option('test', 'password') #移出一个option  也可以使用 remove_section 移出整个section
print '\nModified values:\n'
for section in parser.sections():
    print section
    for name, value in parser.items(section):
        print '  %s = %r' % (name, value)
print '\nSave :\n'
parser.write(sys.stdout)   #修改了只是临时的想要保存下来必须使用write
</pre>
执行过程：
dongwm@linux-dongwm:~&gt; python test.py
test
  url = 'http://localhost:8080'
  username = 'dongwm'
  password = 'passwd'</p>

<p>Modified values:</p>

<p>test
  url = 'http://localhost:8080'
  username = 'dongwm'</p>

<p>Save :</p>

<p>[test]
url = http://localhost:8080
username = dongwm</p>
