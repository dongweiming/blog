---
layout: post
title: 关于sed研究（三）
categories:
- linux基础
- sed
tags:
- sed
published: true
comments: true
indexer: true
---
<p><strong>1 存储空间</strong></p>

<p>dongwm@linux-dongwm:~&gt; cat test.txt
dongwm
ADMIN 1
ailll
AILLL
ccc
ADMIN 2</p>

<p>dongwm@linux-dongwm:~&gt; sed -n -e 'x;n' -e '/ADMIN/{x;p}' test.txt  #临时存储匹配空间的前一行，x;n 转换匹配空间为临时空间，</p>

<p>#读取下一行；/ADMIN/{x;p}，如果这个行的下一行匹配，那么输出临时空间
dongwm
ccc
dongwm@linux-dongwm:~&gt; sed -n -e '/ADMIN/!h' -e '/ADMIN/{x;p}' test.txt  #使用‘h’会让匹配空间和临时空间都缓存这个行，所以使用‘’
dongwm
ccc</p>

<p>dongwm@linux-dongwm:~&gt; sed -n -e '/ADMIN/!h' -e '/ADMIN/{H;x;p}' test.txt #使用‘H’模式空间没有改变，但是临时空间将包含：下一行\n这一行
dongwm
ADMIN 1
ccc
ADMIN 2
dongwm@linux-dongwm:~&gt; sed -n -e '/ADMIN/!h' -e '/ADMIN/{H;x;s/\n/:/;p}' test.txt #这个和上面的意思一样，但是将'\n'替换成了':'
dongwm:ADMIN 1
ccc:ADMIN 2
dongwm@linux-dongwm:~&gt; sed -n -e '/ADMIN/!h' -e '/ADMIN/{g;p}' test.txt  #使用'g'，模式空间改成了下一行，但是临时空间不变，也就是说，</p>

<p>#他从临时空间取到这一行，再把他放在模式空间
dongwm
ccc
dongwm@linux-dongwm:~&gt; sed -n -e '/ADMIN/!h' -e '/ADMIN/{x;G;s/\n/:/;p}' test.txt #简单的说，临时空间不变，模式空间不仅包含以前的行，再添加了临时空间的行
dongwm:ADMIN 1
ccc:ADMIN 2<strong></strong></p>

<p>dongwm@linux-dongwm:~&gt; sed -e '{N;s/\n/:/}' test.txt  #‘N’表示不仅打印这个模式空间行，还加‘\n’再加文件的下一行，在这里使用':'替换了‘\n’
dongwm:ADMIN 1
ailll:AILLL
ccc:ADMIN 2
dongwm@linux-dongwm:~&gt; sed -e '=' test.txt | sed -e '{N;s/\n/:/}' #首先打印行号，然后把行号和这行打印在一行
1:dongwm
2:ADMIN 1
3:ailll
4:AILLL
5:ccc
6:ADMIN 2</p>

<p>dongwm@linux-dongwm:~&gt; sed -n -e 'N' -e '/ADMIN/p' test.txt
dongwm
ADMIN 1
ccc
ADMIN 2
dongwm@linux-dongwm:~&gt; sed -n -e 'N' -e '/ADMIN/P' test.txt#这个‘P’会打印多行中的第一行
dongwm
ccc
dongwm@linux-dongwm:~&gt; cat !$
cat test.txt
dongwm @test1@
ADMIN 1 @test2@
ailll
AILLL @test@
ccc
ADMIN 2</p>

<p>dongwm@linux-dongwm:~&gt; sed -n -e '/@/{/@.*@/{s/@.*@//;p;D}}' test.txt  #这个不好懂 请看下面的拆解
dongwm
AILLL
ccc
dongwm@linux-dongwm:~&gt; sed -n -e '/@/p' test.txt  #打印匹配行
dongwm @test1@
ADMIN 1 @test2@
AILLL @test@
dongwm@linux-dongwm:~&gt; sed -n -e '/@/{/@.*@/p}' test.txt  ＃加了‘N’这样会在模式空间加下面的一行，但是假如下一行也是模式空间就没有下一行
dongwm @test1@
ADMIN 1 @test2@
AILLL @test@
ccc
dongwm@linux-dongwm:~&gt; sed -n -e '/@/{N;/@.*@/{s/@.*@//;p;D}}' test.txt   #‘p’打印，‘D’是删除模式空间
dongwm
AILLL
ccc
dongwm@linux-dongwm:~&gt; sed -e 'h;n;H;x;s/\n/:/;/ADMIN/!b end;s/^/*/;:end' test.txt #看不懂还是看以下的拆解
dongwm
*dongwm:ADMIN 1
ailll
ailll:AILLL
ccc
*ccc:ADMIN 2
dongwm@linux-dongwm:~&gt; sed -e 'h;n;H;x;s/\n/:/' test.txt  #这个很好懂，临时空间包含这行和下一行，'\n'替换成了‘:’
dongwm
dongwm:ADMIN 1
ailll
ailll:AILLL
ccc
ccc:ADMIN 2
dongwm@linux-dongwm:~&gt; sed -e 'h;n;H;x;s/\n/:/;/ADMIN/!b end;s/^/*/;:end' test.txt #匹配行，使用‘b’，使用这标签，把行首添加'*'
dongwm
*dongwm:ADMIN 1
ailll
ailll:AILLL
ccc
*ccc:ADMIN 2
dongwm@linux-dongwm:~&gt; sed -e 'h;n;H;x;s/\n/:/;:repeat;/ADMIN/s/^/*/;/\*\*\*/!t repeat' test.txt #使用't'以前的替代成功，跳转到行标签标记，并继续执行，否则继续正常执行流程。
dongwm                                                                                                                                #如果发现模式空间行没有‘＊＊＊’并且赏个替换成功，就会执行
***dongwm:ADMIN 1
ailll
ailll:AILLL
ccc
***ccc:ADMIN 2</p>
