
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>小明明s à domicile</title>
  <meta name="author" content="Dongweiming">

  
  <meta name="description" content="douban dongweiming site">
  <meta name="keywords" content="python, ipython, emacs, github, dongweiming, django, flask, bottle, jinja2, requests, douban, httpie, jedi, mako, plim, react, develop, lisp, ruby, web development, sed, awk, linux, 运维, 运维开发, sentry, tonrado, scrapy, fabric, celery">
             

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://dongweiming.github.com/blog/page/24">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/bootstrap/bootstrap.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bootstrap/responsive.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/syntax/syntax.css" media="screen, projection" rel="stylesheet" type="text/css">
  <style type="text/css">
    body {
      padding-bottom: 40px;
    }
    h1 {
      margin-bottom: 15px;
    }
    img {
      max-width: 100%;
    }
    .sharing, .meta, .pager {
      margin: 20px 0px 20px 0px;
    }
    .page-footer p {
      text-align: center;
    }
  </style>
  <script src="/javascripts/libs/jquery.js"></script>
  <script src="/javascripts/libs/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/bootstrap.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script type="text/javascript" src="/javascripts/api.js"></script>
  <script type="text/javascript" src="/javascripts/wordcumulus.js"></script>
  <script type="text/javascript" src="/javascripts/swfobject.js"></script>
  <script type="text/javascript" src="/javascripts/tagcumulus.js"></script>
  <link href="/atom.xml" rel="alternate" title="小明明s à domicile" type="application/atom+xml">
  <script type="text/javascript" src="/javascripts/sh_python.min.js"></script>
<script type="text/javascript" src="/javascripts/sh_bash.min.js"></script>
<script type="text/javascript" src="/javascripts/sh_main.min.js"></script>
<link href="/stylesheets/sh_ide-anjuta.css" rel="stylesheet" type="text/css">

  
<script id="search-results-template" type="text/x-handlebars-template">
  {{#entries}}
    <article>
        <h3>
            <small><time datetime="{{date}}" pubdate>{{date}}</time></small>
            <a href="{{url}}">{{title}}</a>
            <p>tagged: {{ tags }} | category: <a href="/categories/{{category }}">{{category}}</a></p>
        </h3>
    </article>
  {{/entries}}
</script>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-20495125-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    onload="sh_highlightDocument('', '.js');">
<a href="http://github.com/dongweiming/">
<img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png" alt="Follower me on GitHub">
</a>
  <nav role="navigation"><div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a class="brand" href="/">小明明s à domicile</a>

      <div class="nav-collapse">
          <ul class="nav">
    <li><a href="/">博客主页</a></li>
    <li><a href="/blog/archives">文章列表</a></li>
    <li><a href="/aboutsite">关于本站</a></li>
    <li><a href="/projects">我的项目</a></li>
    <li><a href="http://dongweiming.github.io/sed_and_awk">sed_and_awk</a></li>
    <li><a href="http://dongweiming.github.io/Expert-Python">Expert-Python</a></li>
    <li><a href="/aboutme">关于我</a></li>
</ul>

          <ul class="nav pull-right" data-subscription="rss">
              <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
          
          </ul>

        

          
            <form action="/search" method="get" class="pull-right navbar-search">
    <fieldset role ="search">
        <input type="text" id="search-query" name="q" placeholder="Search" autocomplete="off" class="search" />
    </fieldset>
</form>

          
      </div>
    </div>
  </div>
</div>
</nav>
  <div class="container">
      <div class="row-fluid">
      <div class="span9">
  
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/bashhistorybiantaiyongfa/">Bash History （变态用法）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-12T00:00:00+08:00" pubdate data-updated="true">Aug 12<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>首先看一个例子：</p>

<p>root@client ~&gt; history</p>

<p>1002  ll /root
1003  cat moxi
1004  cd /home/dongwm
1005  history</p>

<p>1 从历史执行一个特定的命令使用，这里我想要执行“cat moxi”，使用“！histroy前面的数字”</p>

<p>root@client ~&gt; !1003
cat moxi
21233 = {
&#8220;hashAlgorithm&#8221;: &#8220;fnv1a_32&#8221;,
&#8220;numReplicas&#8221;: 2,
&#8220;serverList&#8221;: [&#8220;192.168.8.138:11211&#8221;,&#8221;192.168.8.137:11211&#8221;],
&#8220;vBucketMap&#8221;: [
[0,2,3],
[1,2,3]
]
}</div>
  
  
    <footer>
      <a rel="full-article" href="/archives/bashhistorybiantaiyongfa/">继续阅读 &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/mongodbguanlijiaoben/">Mongodb集群管理脚本（python）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-06T00:00:00+08:00" pubdate data-updated="true">Aug 6<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前言：mongodb集群需要一个管理脚本，比如启动集群，关闭集群，查看集群状态等功能，本脚本使用了pdsh代替ssh，本来为了并行操作，但是事实上在for循环里面并行是不必要的，所以可以改成ssh的。以后会改成多线程并行操作。</p>

<p>本脚本特性：</p>

<p>1 需要安装PDSH （并行的ssh）和termcolor(一个让终端显示颜色的pythonapi)，-h选项有安装方法介绍</p>

<p>2 支持查看集群服务状态（包括查看监听端口列表和各设定服务是否正常，正常状态为绿色，不正常为红色），start/stop/restart等集群服务</p>

<p>3 支持tab自动补齐相关命令</p>

<p>4  启动服务前先判定服务是否运行，防止多次启动。停止服务时给于倒计时，防止误操作</p>

<p>5  效果截图：</p>

<p><img class="alignnone" title="mongodb1" src="http://farm7.static.flickr.com/6143/6034397038_9edf238f9b_z.jpg" alt="" width="640" height="437" /></p>

<p><img class="alignnone" title="mongodb2" src="http://farm7.static.flickr.com/6189/6034397214_dc86e3bd26_z.jpg" alt="" width="640" height="264" /></p>

<p><img class="alignnone" title="mongodb3" src="http://farm7.static.flickr.com/6181/6033847951_a7e188c613_z.jpg" alt="" width="640" height="437" /></p>

<p>本脚本需要一个配置文件conf.cfg，当切换shard或者仲裁到其他服务器上面时候只需要修改此配置文件，本例有7台服务器，其中mongod1代表shard1，mongod3a代表shard3的arbiter，这样的写法是我为了直接在脚本里面取值，因为在相应服务器启动进程使用的是init.d下的脚本，配置文件也是conf型，下面有2个例子：</p>

<p>cat /etc/conf.cfg  //python脚本的配置文件
<pre class="sh_python">
[host]
 hosts=mg01,mg02,mg03,mg04,mg05,mg06,mg07
 [mg01]
 mongod = mongod1,mongod4
 arbiter= mongod3a
 config =
 mongos = mongos
 [mg02]
 mongod = mongod1,mongod4
 arbiter= mongod3a
 config = mongoconfig
 mongos =
 [mg03]
 mongod = mongod1,mongod2
 arbiter= mongod4a
 config =
 mongos = mongos
 [mg04]
 mongod = mongod2
 arbiter= mongod1a,mongod4a
 config = mongoconfig
 mongos =
 [mg05]
 mongod = mongod2,mongod3
 arbiter= mongod1a
 config =
 mongos = mongos
 [mg06]
 mongod = mongod3
 arbiter= mongod2a
 config = mongoconfig
 mongos =
 [mg07]
 mongod = mongod3,mongod4
 arbiter= mongod2a
 config =
 mongos = mongos
</pre></p>

<p>cat /etc/init.d/mongod1  //mongodb进程启动脚本，支持start，stop等
<pre class="sh_bash">
#!/bin/bash</p>

<p># mongod - Startup script for mongod</p>

<p># chkconfig: 35 85 15
 # description: Mongo is a scalable, document-oriented database.
 # processname: mongod
 # config: /etc/mongod.conf
 # pidfile: /var/run/mongo/mongo.pid</p>

<p>. /etc/rc.d/init.d/functions</p>

<p># things from mongod.conf get there by mongod reading it</p>

<p>OPTIONS=" -f /etc/mongod1.conf"</p>

<p>mongod=${MONGOD-/usr/local/mongodb/bin/mongod}</p>

<p>MONGO_USER=mongod
 MONGO_GROUP=mongod</p>

<p>start()
 {
 echo -n $"Starting mongod1: "
 daemon --user "$MONGO_USER" $mongod $OPTIONS
 RETVAL=$?
 echo
 [ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/subsys/mongod1
 }</p>

<p>stop()
 {
 echo -n $"Stopping mongod1: "
 killproc -p /var/lib/mongo/mongod1.lock -t30 -TERM /usr/local/mongodb/bin/mongod
 RETVAL=$?
 echo
 [ $RETVAL -eq 0 ] &amp;&amp; rm -f /var/lock/subsys/mongod1
 }</p>

<p>restart () {
 stop
 start
 }</p>

<p>ulimit -n 12000
 RETVAL=0</p>

<p>case "$1" in
 start)
 start
 ;;
 stop)
 stop
 ;;
 restart|reload|force-reload)
 restart
 ;;
 condrestart)
 [ -f /var/lock/subsys/mongod1 ] &amp;&amp; restart || :
 ;;
 status)
 status $mongod
 RETVAL=$?
 ;;
 *)
 echo "Usage: $0 {start|stop|status|restart|reload|force-reload|condrestart}"
 RETVAL=1
 esac</p>

<p>exit $RETVAL
</pre></p>

<p>cat /etc/mongod1.conf  //mongodb启动脚本需要的conf配置文件，mongos和config配置文件类似
<pre class="sh_bash">
# shard1 config
 shardsvr=true
 replSet=shard1
 port=10000
 fork=true
 journal=true
 dbpath=/data/shard1
 oplogSize=10240
 logpath=/data/shard1/shard1.log
 logappend=true
 pidfilepath=/var/lib/mongo/mongod1.lock
 unixSocketPrefix=/data/shard1/
</pre></p>

<p>下面是python管理脚本：</p>

<p>cat /usr/bin/Mshell.py  //真正的管理脚本</p>

<p><pre class="sh_python">
#!/bin/env python
# coding=gbk</p>

<p>#__doc__注释  执行脚本 -h 或者 --help  打印输出的内容
"""
This script is used to manage mongodb!</p>

<p>The Feature:
1 Support command automatically filled
2 View the current status of the cluster
3 Shut down or start the cluster service</p>

<p>Required dependencies:
1 PDSH -&gt; Parallel Distributed Shell
Installation:
rpm -ivh pdsh-2.24-1.el5.rf.x86_64.rpm
2 termcolor -&gt; ANSII Color formatting for output in terminal
Installation:
python setup.py install</p>

<p>Usage:
/usr/bin/Mshell.py
Note: Does not require any parameters</p>

<p>Writer:Dongweiming</p>

<p>"""
#引用一些需要的模块
import os
import sys
import time
import re
import string
import readline
from subprocess import Popen, PIPE
import ConfigParser
from optparse import OptionParser
from termcolor import colored</p>

<p>class Cfg():
#类初始化函数
    def __init__(self,cfg):
        self.cfg = cfg
        self._parse_configure()
#设定取值逻辑，当出现多个分割格式化
    def _get_value(self,conf, line, key):
        try:
            value = conf.get(line, key)
        except ConfigParser.NoOptionError:
            return []
        if value:
            return [i.strip() for i in value.split(',') if i]
        else:
            return []
#从配置文件中取得某主机某服务相关值
    def _parse_configure(self):
        conf = ConfigParser.RawConfigParser()
        conf.read(self.cfg)
        green_on_grey = lambda x:colored(x,'red','on_grey')
        self.hosts=self._get_value(conf,'host','hosts')
        for h in self.hosts:
            for service in ['arbiter', 'config', 'mongod', 'mongos']:
                setattr(self, '%s_%s' % (h, service), self._get_value(conf, h, service))
                self.h_service=self._get_value(conf, h, service)
#登录Shell打印一些配置文件格式化后的明细
            print green_on_grey('host:\t%s\n') % h
            if getattr(self,'%s_mongod' % h):
                print colored('Shard:\t%s','yellow')  % getattr(self,'%s_mongod' % h )
            if getattr(self,'%s_config' % h):
                print colored('Config server is Open','green')
            if getattr(self,'%s_mongos' % h):
                print colored('Mongos server is Open','magenta')
            if getattr(self,'%s_arbiter' % h):
                print colored('Arbiter:\t%s','blue') % getattr(self,'%s_arbiter' % h )</p>

<p>class Manager(Cfg):
#初始化函数
    def __init__(self,confile):
        Cfg.__init__(self,confile)
        self.services = [ 'arbiter', 'config', 'mongod', 'mongos', 'all','*']
#执行命令的函数，设定命令操作逻辑过程
    def fetch_job(self,cmd):
        cmd = cmd.strip().split(None, 2)
        if len(cmd) == 1 and cmd[0] not in ['show', 'help','status']:
            print '%s what...' % cmd[0]
            return
        service= None
        host = None
#判断当命令以 start stop开始，host和服务是不是再设定的范围值
        if cmd[0] in ['start', 'stop']:
            if '@' in cmd[1]:
                (service,host) = cmd[1].split('@')
                if host not in self.hosts:
                    print 'No such a host %s' % host
                    return
            else:
                service = cmd[1]
                host = 'all'</p>

<p>            if service not in self.services:
                print "bad service %s,Correct parameters: [ 'arbiter', 'config', 'mongod', 'mongos', 'all','*']" % service
                return
#当符合要求 调用下面的_start_srv函数用于启动
            if cmd[0] == 'start' and len(cmd) == 2:
                self._start_srv(host, service)
            elif cmd[0] == 'stop' and len(cmd) &lt;= 3:
                now = False
                if len(cmd) == 3:
                    if cmd[2] == 'now':
                        now = True
                    else:
                        print 'Oops, bad command'
                        return
                self._stop_srv(host, service, now)
            else:
                print 'Oops, bad command'
                return
        elif cmd[0] == 'show':
            self._show_srv()
        elif cmd[0] == 'help':
            self._show_help()
        elif cmd[0] == 'status':
            self._status_srv()
        else:
            print 'command error %s %s' % (cmd[0], cmd[1])
            return
#执行show命令
    def _show_srv(self):
        print  colored('服务器'+('-'*2) + 'PID'+('-'*4)+ '数据'+('-'*10)+'监听端口'+('-'*4)+'服务端口','blue')
        for host in self.hosts:
            cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s ps -ef |grep mongod|grep -v grep' % ( host )
            for line in os.popen(cmd).readlines():
                dict = {}
                s = string.split(line)
                if s[1] == 'mongod':
                    cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s cat %s|grep -v "#"|grep -v "^$"' % (s[0].strip(':'),s[10])
                    for line in os.popen(cmd).readlines():
                        f = string.rstrip(line)
                        value = f.split('=')[1:2]
                        key = f.split('=')[0].split(':')[1]
                        if key != '':
                           dict[key] = value
                           if not dict.get(" replSet"):
                               dict[' replSet']=['NO']
                    print  colored(s[0].ljust(6,' '),"red"),colored(s[2].ljust(6,' '),"green"),colored('%s  %s ','cyan') % (''.join(dict.get(" unixSocketPrefix")).split('/')[2].ljust(14,' '),''.join(dict.get(" port")).ljust(8,' '))
#查看集群状态，执行status命令
    def _status_srv(self):
        yellow_on_grey = lambda x:colored(x,'yellow','on_grey')
        for h in self.hosts:
            print yellow_on_grey('host:\t%s\n') % h
            for str in ','.join(getattr(self,'%s_mongod' % h)).split(','):
                if getattr(self,'%s_mongod' % h):
                       cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s grep "^port" /etc/%s.conf' % (h,str)
                       for line in os.popen(cmd).readlines():
                           cmds ="PDSH_SSH_ARGS_APPEND='-p9922' pdsh -Rssh -w ssh:root@%s netstat -tunlp|egrep '10000|12000|14000|16000'|awk '{print $5}'|cut -d':' -f2"  % h
                           for lines in  os.popen(cmds).readlines():
                               setattr(self, '%s' % h,lines.strip())
                               if line.strip().split('=')[1]  in lines.strip():
                                   print 'Shard :%s\t [%s] ' % (str,colored('ok','green'))
                                   break
                           #else  line.strip().split('=')[1] not in lines.strip():
                           else:
                                   print 'Shard :%s\t [%s] ' % (str,colored('ok','red'))</p>

<p>            if getattr(self,'%s_arbiter' % h):
                for str in ','.join(getattr(self,'%s_arbiter' % h)).split(','):
                        cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s grep "^port" /etc/%s.conf' % (h,str)
                        for line in  os.popen(cmd).readlines():
                            f = string.rstrip(line)
                            cc=f.split('=')[1]
                            cmd1 = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s netstat -tunlp|grep mongo|grep "1[0-9]\{3\}1"' % h
                            for line in  os.popen(cmd1).readlines():
                               t = string.rstrip(line)
                               value=t.split('0.0.0.0:')[1].rstrip()
                               if cc in value:
                                print 'Arbiter :%s\t [%s] ' % (str,colored('ok','green'))
                                break
                            else:
                                print 'Arbiter :%s\t [%s] ' % (str,colored('ok','red'))</p>

<p>            if getattr(self,'%s_config' % h):
                for str in ''.join(getattr(self,'%s_config' % h)).split(','):
                        cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s grep "^port" /etc/mongoconfig.conf' % h
                        for line in  os.popen(cmd).readlines():
                            f = string.rstrip(line)
                            cc=f.split('=')[1]
                            cmd1 = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s netstat -tunlp|grep 20000' % h
                            for line in  os.popen(cmd1).readlines():
                               t = string.rstrip(line)
                               value=t.split('0.0.0.0:')[1].rstrip()
                               if cc in value:
                                  print 'Config :%s\t %s' % (str,('[' + colored('ok','green')+']'))
                                  break
                            else:
                                  print 'Config :%s\t %s' % (str,('[' + colored('ok','red')+']'))
            if getattr(self,'%s_mongos' % h):
                for str in ''.join(getattr(self,'%s_mongos' % h)).split(','):
                        cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w  ssh:root@%s grep "^port" /etc/mongos.conf' % h
                        for line in  os.popen(cmd).readlines():
                            f = string.rstrip(line)
                            cc=f.split('=')[1]
                            cmd1 = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s netstat -tunlp|grep mongos' % h
                        for line in  os.popen(cmd1).readlines():
                            t = string.rstrip(line)
                            value=t.split('0.0.0.0:')[1].rstrip()
                            if cc in value:
                                print 'Mongos :%s\t [%s] ' % (str,colored('ok','green'))
                                break
                        else:
                                print 'Mongos :%s\t [%s] ' % (str,colored('ok','red'))
                                break
#当执行 start 命令
    def _start_srv(self,host,prog):
#当执行start all
        if prog == 'all':
            for h in self.hosts:
                if getattr(self,'%s_mongod' % h):
                    for str in ','.join(getattr(self,'%s_mongod' % h)).split(','):
                        cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s cat /etc/%s.conf|grep -v "#"|grep port' % (h,str)
                        port=os.popen(cmd).readline().split('=')[1]
                        cmds = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s netstat -tunlp |grep %s' % (h,port)
                        true = os.popen(cmds).readline()
                        if true != '':
                            print 'Please stop and start %s mongod process' % h
                        else:
                            cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s start' % (h,str)
                            os.system(cmd)
            for h in self.hosts:
                if getattr(self,'%s_arbiter' % h):
                    for str in ','.join(getattr(self,'%s_arbiter' % h)).split(','):
                        print str
                        cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s cat /etc/%s.conf|grep -v "#"|grep port' % (h,str)
                        port=os.popen(cmd).readline().split('=')[1]
                        cmds = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s netstat -tunlp |grep %s' % (h,port)
                        true = os.popen(cmds).readline()
                        if true != '':
                            print 'Please stop and start %s arbiter process' % h
                        else:
                            cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s start' % (h,str)
                            os.system(cmd)</p>

<p>            for h in self.hosts:
                if getattr(self,'%s_config' % h):
                        print ','.join(getattr(self,'%s_config' % h))
                        cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s cat /etc/mongoconfig.conf|grep -v "#"|grep port' % h
                        port=os.popen(cmd).readline().split('=')[1]
                        cmds = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s netstat -tunlp |grep %s' % (h,port)
                        true = os.popen(cmds).readline()
                        if true != '':
                            print 'Please stop and start %s config process' % h
                        else:
                            cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s start' % (h,','.join(getattr(self,'%s_config' % h)))
                            os.system(cmd)
            for h in self.hosts:
                if getattr(self,'%s_mongos' % h):
                        cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s cat /etc/mongos.conf|grep -v "#"|grep port' % h
                        port=os.popen(cmd).readline().split('=')[1]
                        cmds = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s netstat -tunlp |grep %s' % (h,port)
                        true = os.popen(cmds).readline()
                        if true != '':
                            print 'Please stop and start %s mongos process' % h
                        else:
                           cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s start' % (h,','.join(getattr(self,'%s_mongos' % h)))
                           os.system(cmd)
        else:
            if  host== 'all':
                host = self.hosts
            else:
                host = [host]
            for i in host:
                if  prog == '*':
                    if getattr(self,'%s_mongod' % i):
                        for str in ','.join(getattr(self,'%s_mongod' % i)).split(','):
                            print str
                            cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s start' % (i,str)
                            os.system(cmd)
                    if getattr(self,'%s_arbiter' % i):
                        for str in ','.join(getattr(self,'%s_mongod' % i)).split(','):
                            print str
                            cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s start' % (i,str)
                            os.system(cmd)
                    for service in ['config', 'mongos']:
                        if getattr(self,'%s_%s' % (i,service)):
                            cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s start' % (i,','.join(getattr(self,'%s_%s' % (i,service))))
                            os.system(cmd)
                if prog == 'mongod':
                    if getattr(self,'%s_mongod' % i):
                        for str in ','.join(getattr(self,'%s_mongod' % i)).split(','):
                            print str
                            cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s start' % (i,str)
                            os.system(cmd)
                if prog == 'mongos':
                    print ','.join(getattr(self,'%s_mongos' % i))
                    if getattr(self,'%s_mongos' % i):
                        cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s start' % (i,','.join(getattr(self,'%s_mongos' % i)))
                        os.system(cmd)
                if prog == 'config':
                    print ''.join(getattr(self,'%s_config' % i))
                    if getattr(self,'%s_config' % i):
                        cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s start' % (i,','.join(getattr(self,'%s_config' % i)))
                        os.system(cmd)
                if prog == 'arbiter':
                    print ','.join(getattr(self,'%s_arbiter' % i))
                    if getattr(self,'%s_arbiter' % i):
                        for str in ','.join(getattr(self,'%s_mongod' % i)).split(','):
                            cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s start' % (i,str)
                        os.system(cmd)
#当执行stop 的一些设置
    def _stop_srv(self, host, prog, now):
        if host == 'all':
            host = self.hosts
        else:
            host = [host]
        verify = None
#当执行 stop all
        if prog == 'all':
            if not now:
#执行前做确定验证，并倒计时3秒
                try:
                    verify = raw_input(colored("Are you sure to stop all? (y/n) ","yellow")).lower()
                    if verify == 'y':
                        print "&gt;&gt;&gt; Waiting 3 seconds before stoping..."
                        print "&gt;&gt;&gt; (Control-C to abort)..."
                        print "&gt;&gt;&gt; Stoping in:",</p>

<p>                        for i in range(3, 0, -1):
                            print colored('%d','red') % i,
                            sys.stdout.flush()
                            time.sleep(1)
                        print
                    else:
                        return
                except KeyboardInterrupt:
                    print
                    return
#stop 过程逻辑
            for host in self.hosts:
                if getattr(self,'%s_mongos' % host):
                    ','.join(getattr(self,'%s_mongos' % host))
                    cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s stop' % (host,','.join(getattr(self,'%s_mongos' % host)))
                    os.system(cmd)
            for host in self.hosts:
                if getattr(self,'%s_config' % host):
                    print ','.join(getattr(self,'%s_config' % host))
                    cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s stop' % (host,','.join(getattr(self,'%s_config' % host)))
                    os.system(cmd)
            for host in self.hosts:
                if getattr(self,'%s_arbiter' % host):
                    for str in ','.join(getattr(self,'%s_arbiter' % host)).split(','):
                        cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s stop' % (host,str)
                        os.system(cmd)
            for host in self.hosts:
                if getattr(self,'%s_mongod' % host):
                    for str in ','.join(getattr(self,'%s_mongod' % host)).split(','):
                            cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s stop' % (host,str)
                            os.system(cmd)
#当执行stop service@XX 逻辑过程
        else:
            for i in host:
                if  prog == '*':
                    if getattr(self,'%s_mongod' % i):
                        for str in ','.join(getattr(self,'%s_mongod' % i)).split(','):
                            print str
                            cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s stop' % (i,str)
                            os.system(cmd)
                    for service in ['arbiter', 'config', 'mongos']:
                        if getattr(self,'%s_%s' % (i,service)):
                            cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s stop' % (i,','.join(getattr(self,'%s_%s' % (i,service))))
                            os.system(cmd)
                if prog == 'mongod':
                    if getattr(self,'%s_mongod' % i):
                        for str in ','.join(getattr(self,'%s_mongod' % i)).split(','):
                            print str
                            cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s stop' % (i,str)
                            os.system(cmd)
                if prog == 'mongos':
                    if getattr(self,'%s_mongos' % i):
                        print ','.join(getattr(self,'%s_mongos' % i))
                        cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s stop' % (i,','.join(getattr(self,'%s_mongos' % i)))
                        os.system(cmd)
                if prog == 'config':
                    if getattr(self,'%s_config' % i):
                        print ','.join(getattr(self,'%s_config' % i))
                        cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s stop' % (i,','.join(getattr(self,'%s_config' % i)))
                        os.system(cmd)
                if prog == 'arbiter':
                    if getattr(self,'%s_arbiter' % i):
                        print ','.join(getattr(self,'%s_arbiter' % i))
                        cmd = 'PDSH_SSH_ARGS_APPEND="-p9922" pdsh -Rssh -w ssh:root@%s /etc/init.d/%s stop' % (i,','.join(getattr(self,'%s_arbiter' % i)))
                        os.system(cmd)
#当执行help打印一些帮助信息
    def _show_help(self):
        help = " CMD                        ARGS                          DESCRIPTOR               \n" \
             " ==============================================================================         \n" \
             " start/stop       all/mongod/arbiter/config/mongos        启动关闭进程          \n" \
             " 注：启动关闭方式：1 start/stop service@host \n"  \
             "                   2 start/stop all（相当于start/stop * \n" \
             "                   3 start/stop service     \n" \
             " 例子：停止集群mongos服务： stop  mongos \n" \
             "       启动集群mg02主机的config服务：start  config@mg02 \n" \
             "       停止整个集群服务： stop all\n" \
             " help                                                     找到帮助      \n" \
             " show                                                     查看当前启动进程      \n" \
             " status                                                   查看状态     \n" \
             " ==============================================================================         \n"
        print help                 </p>

<p>#Shell累 主要是用户操作的一些指导
class Shell:
#设定进入Shell显示的颜色和语言
    PROMPT = colored('root','green') + colored('@MongoDB# ','red')
#初始化函数 设定配置文件conf.cfg，命令行限制可以使用的几个命令
    def __init__(self):
        confile = os.path.join("", '/etc/conf.cfg')
        self.cmds = ['start', 'stop', 'show', 'log', 'help','status']
#调用类Manager
        self.manager = Manager(confile)
#        self.pro = Cfg(confile)
    def start(self):
        readline.set_completer(self._completer)
        readline.parse_and_bind("tab: complete")
        while True:
            try:
                cmd = raw_input(self.PROMPT)
            except EOFError:
                print colored('Exit','green')
                exit(0)
            except KeyboardInterrupt:
                print colored('type ctrl-D to exit Mongo Manager Shell','yellow')
                continue
            if cmd:
                self._parse_cmd(cmd)
    def _completer(self, word, index):
        matches = [c for c in self.cmds if c.startswith(word)]
        try:
            return matches[index] + ''
        except IndexError:
            pass
    def _shell(self, cmd):
        print 'Mongo-Shell: "%s": command not find  please input "help"' % cmd
#判断命令开始是不是设定的那几个词语，是-&gt;执行fetch_job函数
    def _parse_cmd(self, cmd):
        if cmd.startswith('start') or \
                cmd.startswith('stop') or \
                cmd.startswith('show') or \
                cmd.startswith('status') or \
                cmd.startswith('help') or \
                cmd.startswith('log'):
            self.manager.fetch_job(cmd)
        else:
            self._shell(cmd)
#主函数
if __name__ == '__main__':
    argc = len(sys.argv)
    parser = OptionParser(description="Use For Mongodb Shell",prog="Mshell.py",version="1.0",usage="%prog")
    parser.add_option("-v", "--verbose",action="count",help="Show Shell Version Information(For more information, please use the option: -vv)")
    options, arguments=parser.parse_args()
#判断是否root
    if os.geteuid() != 0:
        print red('Need to be root :(')
        exit(1)
#当脚本不带参数引发调用类Shell
    if argc == 1:
        test = Shell()
        test.start()
#当不了脚本的用户使用-h或者--help  给与doc提示
    if '-h' in sys.argv  or '--help' in sys.argv:
        print __doc__
    elif options.verbose ==1:
        print __doc__
    elif options.verbose ==2:
        print __doc__
        print "Version =1.0  Revision time at 2011年 07月 04日"
    else:
        print '请直接运行脚本，不需要附带参数'
</pre></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/sikewangluoanquanzhuantierguanyuluyouqianquan/">思科网络安全专题（二）:关于路由器安全</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-01T00:00:00+08:00" pubdate data-updated="true">Aug 1<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>怎么说我也是ccsp出生，呵呵也看过很多IE级别的关于安全的书 ，所以最近准备做一个基于配置的关于安全的专题。</p>

<p>1  vty访问</p>

<p>虚拟终端访问当然需要一些安全</p>

<p>3640_M(config)#aaa new-model
3640_M(config)#aaa authentication login for-ssh local</p>

<p>3640_M(config)#username dongwm password dongwmtest</p>

<p>3640_M(config)#line vty 0 4
3640_M(config-line)#transport input ssh
3640_M(config-line)#exec-timeout 3 30  //超时时间为3分30秒
3640_M(config-line)#login authentication for-ssh</p>

<p>2 记录路由器事件</p>

<p>3640_M(config)#service timestamps debug datetime msec localtime show-timezone
3640_M(config)#service timestamps log datetime msec localtime show-timezone   //用Log信息和Debug信息的时间戳，格式为Datetime：，并且支持毫秒显示
3640_M(config)#no logging console  //<span>禁止在控制台上打印日志报文</span>
3640_M(config)#logging buffered 16384  //将日志信息记录到内存缓冲区的大小</div>
  
  
    <footer>
      <a rel="full-article" href="/archives/sikewangluoanquanzhuantierguanyuluyouqianquan/">继续阅读 &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/luyouqishangmianqiyonganquanshellssh/">路由器上面启用安全Shell（ssh）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-31T00:00:00+08:00" pubdate data-updated="true">Jul 31<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>R1(config)#ip domain-name dongwm.com</p>

<p>R1(config)#crypto key zeroize rsa
% No Signature RSA Keys found in configuration.  //想把配置中的rsa清除 但是发现配置中没有配置 呵呵</p>

<p>R1(config)#crypto key generate rsa general-keys modulus 1024  //产生SSH所用安全密钥 长度为1024 类型为rsa</p>

<p>% You already have RSA keys defined named R1.dongwm.com.
% They will be replaced.</p>

<p>% The key modulus size is 1024 bits
% Generating 1024 bit RSA keys, keys will be non-exportable&#8230;
*Mar  1 00:06:14.043: %SSH-5-DISABLED: SSH 1.99 has been disabled[OK]
*Mar  1 00:06:20.631: %SSH-5-ENABLED: SSH 1.99 has been enabled</p>

<p>R1(config)#ip ssh time-out 90  //设置ssh超市时间为90s</p>

<p>R1(config)#ip ssh authentication-retries 4  //重置ssh验证的错误尝试次数</p>

<p>R1(config)#line vty 0 15</p>

<p>R1(config-line)#transport input ssh //容许vty线路使用ssh</p>

<p>R1#sh crypto key mypubkey rsa
% Key pair was generated at: 00:06:20 UTC Mar 1 2002
Key name: R1.dongwm.com
Usage: General Purpose Key
Key is not exportable.
Key Data:
30819F30 0D06092A 864886F7 0D010101 05000381 8D003081 89028181 00C04D5B
EA7876B0 DAD6D615 6F2B7DC6 8A6DB09A FA3C1EA0 36173B5C ACCC56C2 796D814B
9F27CECF C48FD5D9 F9547F96 4623BDD2 D53CA81D D95B426F 64DB1D2B 01CD2BD0
6C7223BB 3DDA577A 7E1D9AA8 7D48080E A9EB69E5 93A3E851 41F22715 27961027
E254956F 7E6C23F3 4D314CF9 75E99F1B 1A0F287D 1AC4D83A 2AA7BD8F 55020301 0001
% Key pair was generated at: 00:06:21 UTC Mar 1 2002
Key name: R1.dongwm.com.server
Usage: Encryption Key
Key is not exportable.
Key Data:
307C300D 06092A86 4886F70D 01010105 00036B00 30680261 00D36FB0 D8F4A184
7C8CAEAB C5F0155F B7FA5BEB 65096F81 18359560 53D5F9C9 CF2C0470 F04EE42B
773E4E4F 7B181E2E BC83D77B 2C9A6C54 247D4ECA 77E53770 D440F979 A7A327CE
5B35A59C 61EE0AD9 9A4D0C09 EE108B57 F906A97E FF24BE90 CF020301 0001</p>

<p>&nbsp;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/guanyujiaohuanjianquan/">思科网络安全专题（一）:关于交换机安全</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-31T00:00:00+08:00" pubdate data-updated="true">Jul 31<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>生产环境交换机比较多，以前的同事没有对其进行什么安全策略，就是简单配置一个登录密码而已。我接手后进行了一些改造！</p>

<p>1 禁用DTP，中继</p>

<p>因为一些交换机默认的中继为auto模式。可能在收到dtp协议帧后自动成为中继。</p>

<p>SW1(config-if)# int range fastEthernet 0/1  - 48</p>

<p>SW1(config-if-range)#switchport mode access</p>

<p>2 stp安全</p>

<p>如果攻击者获得2个不同交换的2个端口，可将一个交换机引入网络，配置更高的桥优先级，使之比根桥的桥接优先级更低，这样stp重新收敛后就会被这个冒充交换机截取流量</p>

<p>1 根保护： 收到bpdu后进入根保护不一致的状态，端口不再转发流量，bpdu停止后恢复</p>

<p>SW1(config-if)# int range fastEthernet 0/1  - 48</p>

<p>SW1(config-if-range)#spanning-tree  guard root</div>
  
  
    <footer>
      <a rel="full-article" href="/archives/guanyujiaohuanjianquan/">继续阅读 &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/zhandaozhanvpnyugongxiangmiyue/">站到站VPN(预共享密钥)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-30T00:00:00+08:00" pubdate data-updated="true">Jul 30<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><span style="color: #c00000;"><span style="font-family: Arial,sans-serif;"><span style="font-size: medium;"><strong>R1</strong></span></span><span style="font-size: medium;"><strong>配置</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="font-family: Arial,sans-serif;"><strong>line con 0</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-line)#</span><span style="font-family: Arial,sans-serif;"><strong>logg sy</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-line)#</span><span style="font-family: Arial,sans-serif;"><strong>exit</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="font-family: Arial,sans-serif;"><strong>no ip domain-lookup</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="font-family: Arial,sans-serif;"><strong>int loopback 0</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>ip add 1.1.1.1 255.255.255.255</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>int f0/0</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>no sh</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>ip add 192.168.3.1 255.255.255.0</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>int e1/3</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>no sh</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>ip add 192.168.15.1 255.255.255.0</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>exit</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="font-family: Arial,sans-serif;"><strong>ip route 0.0.0.0 0.0.0.0 192.168.15.5</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #0070c0;"><span style="font-family: Arial,sans-serif;"><strong>access-list 100 permit ip 1.1.1.1 0.0.0.0 5.5.5.5 0.0.0.0</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #c00000;"><span style="font-family: Arial,sans-serif;"><strong>crypto isakmp policy 10</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp)#</span><span style="color: #c00000;"><span style="font-family: Arial,sans-serif;"><strong>authentication pre-share</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp)#</span><span style="color: #c00000;"><span style="font-family: Arial,sans-serif;"><strong>encryption aes 128</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp)#</span><span style="color: #c00000;"><span style="font-family: Arial,sans-serif;"><strong>group 2</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp)#</span><span style="color: #c00000;"><span style="font-family: Arial,sans-serif;"><strong>hash sha</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp)#</span><span style="font-family: Arial,sans-serif;"><strong>exit</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #00b050;"><span style="font-family: Arial,sans-serif;"><strong>crypto ipsec transform-set cisco esp-aes 128 esp-sha-hmac</div>
  
  
    <footer>
      <a rel="full-article" href="/archives/zhandaozhanvpnyugongxiangmiyue/">继续阅读 &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/yuanchengjieruvpn/">远程接入VPN</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-30T00:00:00+08:00" pubdate data-updated="true">Jul 30<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><span style="color: #c00000;"><span style="font-size: medium;"><strong>服务器端配置</strong></span><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;"><span style="font-size: medium;"><strong>(R1)</strong></span></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router&gt;</span><span style="font-family: Arial,sans-serif;"><strong>enable</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router#</span><span style="font-family: Arial,sans-serif;"><strong>configure terminal</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router(config)#</span><span style="font-family: Arial,sans-serif;"><strong>line console 0</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router(config-line)#</span><span style="font-family: Arial,sans-serif;"><strong>logging synchronous</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router(config-line)#</span><span style="font-family: Arial,sans-serif;"><strong>exit</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router(config)#</span><span style="font-family: Arial,sans-serif;"><strong>interface fastEthernet 0/0</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>no shutdown</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>ip address 192.168.3.1 255.255.255.0</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>exit</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router(config)#</span><span style="font-family: Arial,sans-serif;"><strong>int ethernet 1/3</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>no shutdown</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>ip address 192.168.15.1 255.255.255.0</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router(config-if)#</span><span style="font-family: Arial,sans-serif;"><strong>exit</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">Router(config)#</span><span style="font-family: Arial,sans-serif;"><strong>hostname R1</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="font-family: Arial,sans-serif;"><strong>ip route 192.168.2.0 255.255.255.0 192.168.15.5</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #c00000;"><span style="font-family: Arial,sans-serif;"><strong>aaa new-model</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #c00000;"><span style="font-family: Arial,sans-serif;"><strong>aaa authentication login default local</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #c00000;"><span style="font-family: Arial,sans-serif;"><strong>aaa authentication login ezvpn local</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #c00000;"><span style="font-family: Arial,sans-serif;"><strong>aaa authorization network ezvpn local</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #c00000;"><span style="font-family: Arial,sans-serif;"><strong>username admin privilege 15 secret admin</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #c00000;"><span style="font-family: Arial,sans-serif;"><strong>username cisco secret cisco</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #0070c0;"><span style="font-family: Arial,sans-serif;"><strong>crypto isakmp policy 10</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp)#</span><span style="color: #0070c0;"><span style="font-family: Arial,sans-serif;"><strong>encryption 3des</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp)#</span><span style="color: #0070c0;"><span style="font-family: Arial,sans-serif;"><strong>hash sha</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp)#</span><span style="color: #0070c0;"><span style="font-family: Arial,sans-serif;"><strong>authentication pre-shar</strong></span></span><span style="font-family: Arial,sans-serif;">e </span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp)#</span><span style="color: #0070c0;"><span style="font-family: Arial,sans-serif;"><strong>group 2</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp)#</span><span style="font-family: Arial,sans-serif;"><strong>exit</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #0070c0;"><span style="font-family: Arial,sans-serif;"><strong>crypto isakmp keepalive 20 3</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #7030a0;"><span style="font-family: Arial,sans-serif;"><strong>ip local pool vpn 192.168.3.100 192.168.3.120</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #7030a0;"><span style="font-family: Arial,sans-serif;"><strong>access-list 100 permit ip 192.168.3.0 0.0.0.255 any</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config)#</span><span style="color: #7030a0;"><span style="font-family: Arial,sans-serif;"><strong>crypto isakmp client configuration group vpn</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp-group)#</span><span style="color: #7030a0;"><span style="font-family: Arial,sans-serif;"><strong>acl 100</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp-group)#</span><span style="color: #7030a0;"><span style="font-family: Arial,sans-serif;"><strong>include-local-lan</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp-group)#</span><span style="color: #7030a0;"><span style="font-family: Arial,sans-serif;"><strong>key vpn</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp-group)#</span><span style="color: #7030a0;"><span style="font-family: Arial,sans-serif;"><strong>max-users 20</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp-group)#</span><span style="color: #7030a0;"><span style="font-family: Arial,sans-serif;"><strong>max-logins 1</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp-group)#</span><span style="color: #7030a0;"><span style="font-family: Arial,sans-serif;"><strong>pfs</strong></span></span></span></p>

<p><span style="font-family: Times New Roman,serif;"><span style="font-family: Arial,sans-serif;">R1(config-isakmp-group)#</span><span style="color: #7030a0;"><span style="font-family: Arial,sans-serif;"><strong>pool vpn</strong></span></span></span></p>

<p></div>
  
  
    <footer>
      <a rel="full-article" href="/archives/yuanchengjieruvpn/">继续阅读 &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/%E5%AE%89%E8%A3%85%E5%8F%8A%E9%85%8D%E7%BD%AEicinga-web/">安装及配置icinga-web</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-29T00:00:00+08:00" pubdate data-updated="true">Jul 29<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前言：我所认为的icinga-web其实就是将icinga监控数据写到数据库，用icinga-web对其进行一些处理返回检查的状态
<img style="max-width: 800px;" src="http://farm7.static.flickr.com/6025/5986605311_38600dbb57_b.jpg" alt="" />
1 安装一些必备的rpm包：
yum install libdbi-devel libdbi libdbi-drivers libdbi-dbd-mysql
2 首先需要安装支持IDOUtils的icinga
wget http://sourceforge.net/projects/icinga/files/icinga/1.4.2/icinga-1.4.2.tar.gz/download
tar zxvf icinga-1.4.2.tar.gz
cd icinga-1.4.2
./configure  &#8211;with-icinga-group=dongwm  &#8211;with-icinga-user=dongwm  &#8211;with-command-user=dongwm  &#8211;with-command-group=dongwm &#8211;enable-idoutils &amp;&amp; make all &amp;&amp; make  fullinstall
3 安装nagios插件
wget http://prdownloads.sourceforge.net/sourceforge/nagiosplug/nagios-plugins-1.4.15.tar.gz
tar zxvf nagios-plugins-1.4.15.tar.gz
cd nagios-plugins-1.4.15
./configure &#8211;prefix=/usr/local/icinga &#8211;with-cgiurl=/icinga/cgi-bin &#8211;with-htmurl=/icinga &#8211;with-nagios-user=dongwm &#8211;with-nagios-group=dongwm &amp;&amp; make &amp;&amp; make install
4 配置idoutils
cd /usr/local/icinga/etc/
mv ido2db.cfg-sample ido2db.cfg
mv idomod.cfg-sample idomod.cfg
vi /usr/local/icinga/etc/icinga.cfg
讲这句前面的注释去掉：
broker_module=/usr/local/icinga/bin/idomod.o config_file=/usr/local/icinga/etc/idomod.cfg
确认库文件依赖关系是否正常：
ldd /usr/local/icinga/bin/idomod.o
输出类似：
linux-vdso.so.1 =&gt;  (0x00007fff7f5fc000)
libc.so.6 =&gt; /lib64/libc.so.6 (0x00002b2cbf799000)
/lib64/ld-linux-x86-64.so.2 (0x0000003472c00000)
表示相关库文件都找到
创建mysql数据库：
<pre class="code-java">mysql -u root -p
 mysql&gt; CREATE DATABASE icinga;
 GRANT USAGE ON *.* TO 'icinga'@'localhost' IDENTIFIED BY 'icinga' WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0;
 GRANT SELECT , INSERT , UPDATE , DELETE ON icinga.* TO 'icinga'@'localhost';
 FLUSH PRIVILEGES ;
 quit
mysql -u root -p icinga &lt; /icinga安装目录/module/idoutils/db/mysql/mysql.sql
5 安装icinga-web
wget http://sourceforge.net/projects/icinga/files/icinga-web/1.4.1/icinga-web-1.4.1.tar.gz/download
tar zxvf icinga-web-1.4.1.tar.gz
cd icinga-web-1.4.1
./configure --prefix=/usr/local/icinga-web --with-web-user=dongwm --with-web-group=dongwm --with-db-type=mysql --with-db-host=localhost --with-db-port=3306 --with-db-name=icinga_web --with-db-user=icinga_web --with-db-pass=icinga_web --with-icinga-api=/usr/local/icinga/share/icinga-api --with-web-apache-path=/etc/httpd/conf.d
make all
make install
创建mysql数据库：
mysql -u root -p
 mysql&gt; CREATE DATABASE icinga_web;
        GRANT USAGE ON *.* TO 'icinga_web'@'localhost' IDENTIFIED BY 'icinga_web' WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0;
        GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, ALTER, INDEX ON icinga_web.* TO 'icinga_web'@'localhost';
        quit</p>

<p>mysql -u root -p icinga_web &lt; /icinga-web安装目录/etc/schema/mysql.sql
确认以下文件相关数据库相关信息：
/usr/local/icinga-web/app/modules/Web/config/icinga-io.site.xml
&lt;setting name="api.interfaces.data"&gt;
                &lt;ae:parameter name="api_type"&gt;IcingaApi::CONNECTION_IDO&lt;/ae:parameter&gt;
                &lt;ae:parameter name="config_type"&gt;mysql&lt;/ae:parameter&gt;
                &lt;ae:parameter name="config_host"&gt;127.0.0.1&lt;/ae:parameter&gt;
                &lt;ae:parameter name="config_port"&gt;3306&lt;/ae:parameter&gt;
                &lt;ae:parameter name="config_database"&gt;icinga&lt;/ae:parameter&gt;
                &lt;ae:parameter name="config_user"&gt;icinga&lt;/ae:parameter&gt;
                &lt;ae:parameter name="config_password"&gt;icinga&lt;/ae:parameter&gt;
                &lt;ae:parameter name="config_table_prefix"&gt;icinga_&lt;/ae:parameter&gt;
        &lt;/setting&gt;
注意：这里是icinga-web的配置文件里面用的数据库是icinga的数据库信息，这样才能取到相关值
清除缓存数据：
/usr/local/icinga-web/bin/clearcache.sh
然后使用一下地址登录icinga-web：
http://localhost/icinga-web
最重要的这里的默认帐号密码：root/password
然后就可以看见icinga里面监控项的相关信息了！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/kongzhipingmianheguanlipingmiananquan-2/">控制平面和管理平面安全</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-29T00:00:00+08:00" pubdate data-updated="true">Jul 29<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><span style="color: #c00000;"><span style="font-family: Arial,sans-serif;"><span style="font-size: medium;"><strong>R3 </strong></span></span><span style="font-size: medium;"><strong>上的</strong></span><span style="font-family: Arial,sans-serif;"><span style="font-size: medium;"><strong>VLAN</strong></span></span><span style="font-size: medium;"><strong>配置</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;">VLAN3 Fa0/0, Fa0/3</span></p>

<p><span style="font-family: Times New Roman,serif;">VLAN14 Fa0/1, Fa0/4</span></p>

<p>&nbsp;</p>

<p><span style="color: #c00000;"><span style="font-family: Times New Roman,serif;"><span style="font-size: medium;"><strong>R1</strong></span></span><span style="font-size: medium;"><strong>配置</strong></span></span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config)#int e1/0</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config-if)#no sh</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config-if)#ip add 192.168.1.1</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config-if)#int e1/1</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config-if)#no sh</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config-if)#ip add 192.168.2.1 255.255.255.0</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config-if)#exit</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config)#line vty 0 4</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config-line)#login local</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config-line)#exit</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config)#username cisco123 privilege 15 secret cisco123</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config)#ip access-list extended CoPP-acl</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config-ext-nacl)#deny tcp host 192.168.2.2 any eq telnet</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config-ext-nacl)#deny tcp host 192.168.2.2 any eq www
</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config-ext-nacl)#permit tcp any any eq telnet</span></p>

<p><span style="font-family: Times New Roman,serif;">R1(config-ext-nacl)#permit tcp any any eq www //建立ACL，允许到管理平面的telnet和http访问</div>
  
  
    <footer>
      <a rel="full-article" href="/archives/kongzhipingmianheguanlipingmiananquan-2/">继续阅读 &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/nrpe%E6%A8%A1%E5%BC%8F%E6%A3%80%E6%9F%A5mongo%E8%BF%9B%E7%A8%8B%E8%84%9A%E6%9C%AC/">Nrpe模式检查mongodb进程脚本</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-28T00:00:00+08:00" pubdate data-updated="true">Jul 28<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前言：nagios检查状态无外乎三种方式：1 直接到客户端取状态 2 nrpe间接再客户端取状态 3 被动检查通过nsca向nagios主服务器传送状态。这里是nrpe模式检查状态，要点包括 1 再nagios配置文件添加services 2 在客户端的nrpe.cfg里面添加command</p>

<p>1 在nagios添加配置：</p>

<p>define service{
use                     major-service
hostgroup_name          MongoGroup
service_description     check_mongo_procs
check_command           check_nrpe!check_mongo_procs  //选择nrpe模式
servicegroups           memory
contact_groups          sys
_SRCTYPE                sys
}</p>

<p>2 客户端nrpe.cfg添加：</p>

<p>command[check_mongo_procs]=/usr/local/nagios/libexec/check_mongopro.py</p>

<p>并重启nrpe进程</p>

<p>3 客户端脚本</p>

<p>cat /usr/local/nagios/libexec/check_mongopro.py</p>

<p><pre class="sh_python">
#!/bin/env python
# coding=gbk
import os
import sys
from subprocess import Popen, PIPE</p>

<p>list =[]
cmd = 'chkconfig --list |grep "启用"|grep mongo'
for line in os.popen(cmd).readlines():
     pro = line.split(' ')[0] 
     p1=Popen(['ps', '-ef'], stdout=PIPE)
     p2 = Popen(['grep', '-v', 'grep'], stdin=p1.stdout, stdout=PIPE) 
     p3 = Popen(['grep', '/etc/%s.conf' % pro], stdin=p2.stdout, stdout=PIPE)
     p4 = Popen(['awk', '{print $3}'], stdin=p3.stdout, stdout=PIPE)
     flag2 = [int(i.strip()) for i in p4.communicate()[0].split('\n') if i]
     if 1 not in flag2:
         list.append(pro)
         flag =1
if flag==1:
    print 'CRITICAL %s is dead!' % ','.join(list)
    sys.exit(2)
else:
    print 'Mongo Pro is OK'
</pre></p>
</div>
  
  


    </article>
  
  <ul class="pager">
    
    <li class="previous"><a href="/page/25/">&larr; Older</a></li>
    
    <li><a href="/blog/archives">博客文章</a></li>
    
    <li class="next"><a href="/page/23/">Newer &rarr;</a></li>
    
  </ul>
</div>
<aside class="sidebar-nav span3">
  
    <section class='well'>
    <ul id='qq' class='nav'>
        <li class='nav-header'>我新建了一个QQ群</li>
        <li style="padding-left: 15px;">121435120</li>
        <li style="padding-left: 15px;">欢迎入伙</li>
    </ul>
</section>
<section class="well">
  <ul id="recent_posts" class="nav nav-list">
    <li class="nav-header">最近发布</li>
    
      <li class="post">
        <a href="/archives/zui-jin-zai-xie-ben-webkai-fa-zhu-ti-de-shu/">最近在写一本Web开发主题的书</a>
      </li>
    
      <li class="post">
        <a href="/archives/codekai-yuan-liao/">CODE开源了</a>
      </li>
    
      <li class="post">
        <a href="/archives/12ge-pythonnao-jin-ji-zhuan-wan/">12个python填空题</a>
      </li>
    
      <li class="post">
        <a href="/archives/wo-li-jie-de-pythonzui-jia-shi-jian/">我理解的python最佳实践</a>
      </li>
    
      <li class="post">
        <a href="/archives/pythonjin-jie-bi-du-hui-zong/">python进阶必读汇总</a>
      </li>
    
      <li class="post">
        <a href="/archives/liao-liao-pythonmian-shi-zhe-jian-shi-er/">聊聊python面试这件事儿</a>
      </li>
    
      <li class="post">
        <a href="/archives/idiomatic-python/">idiomatic python</a>
      </li>
    
      <li class="post">
        <a href="/archives/r-shang-chuan-wen-jian-fu-wu/">r - 上传文件服务</a>
      </li>
    
      <li class="post">
        <a href="/archives/dou-ban-tiao-mu-zu-zhao-pin/">[置顶]豆瓣条目组招聘-产品开发</a>
      </li>
    
      <li class="post">
        <a href="/archives/ast-xiang-lisp%5B%3F%5D-yang-zi-ding-yi-dai-ma-xing-wei/">AST - 像lisp一样自定义代码行为</a>
      </li>
    
  </ul>
</section>
<section class="well">
  <ul id="recent_posts" class="nav nav-list">
  <li class="nav-header">个人网站</li>
    <li class="post"><a href="http://salogs.com">带我入行的boss</a></li>
    <li class="post"><a href="http://dongweiming.github.com/">小明明s Github Blog</a></li>
    <li class="post"><a href="http://youhouer.appspot.com/">Love story(GAE)</a></li>
    <li class="post"><a href="http://www.unixhot.com">unixhot运维社区</a></li>
    <li class="post"><a href="http://www.vpsee.com">Vpsee</a></li>
    <li class="post"><a href="http://dongweiming.github.io/sed_and_awk/">sed_and_awk</a></li>
    <li class="post"><a href="http://dongweiming.github.io/Expert-Python">Expert-Python</a></li>
  </ul>
</section>

<section class="well">
  <ul id="gh_repos" class="nav">
    <li class="nav-header">GitHub帐号</li>
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/dongweiming">@dongweiming</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        github.showRepos({
            user: 'dongweiming',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/asides/github.js" type="text/javascript"> </script>
</section>




<section class="well">
   <ul id="gh_repos" class="nav">
    <li class="nav-header">标签Cloud</li>
  </ul>
  <div id="tag-cloud"></div>
</section>

<section class="well">
  <ul id="gh_repos" class="nav">
    <li class="nav-header">豆瓣阅读</li>
  </ul>
  <script type="text/javascript" src="http://www.douban.com/service/badge/62943420/?select=random&amp;n=10&amp;columns=2&amp;picsize=medium&amp;hidelogo=true&amp;hideself=true&amp;cat=book|music" ></script>
  <a href="https://www.douban.com/people/62943420">@小明明</a> on Douban 
</section>


<section class='well'>
<ul id='gh_repos' class='nav'>
<li class='nav-header'>文章统计</li>
<li>本站共有 271 篇文章</li>
</ul>
</section>


  
</aside>

      </div>
  </div>
  <footer role="contentinfo" class="page-footer"><hr>
<p>
  Copyright &copy; 2016 - Dongweiming -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dongwm';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
