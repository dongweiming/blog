
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>小明明s à domicile</title>
  <meta name="author" content="Dongweiming">

  
  <meta name="description" content="douban dongweiming site">
  <meta name="keywords" content="python, ipython, emacs, github, dongweiming, django, flask, bottle, jinja2, requests, douban, httpie, jedi, mako, plim, react, develop, lisp, ruby, web development, sed, awk, linux, 运维, 运维开发, sentry, tonrado, scrapy, fabric, celery">
             

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://dongweiming.github.com/blog/page/22">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/bootstrap/bootstrap.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bootstrap/responsive.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/syntax/syntax.css" media="screen, projection" rel="stylesheet" type="text/css">
  <style type="text/css">
    body {
      padding-bottom: 40px;
    }
    h1 {
      margin-bottom: 15px;
    }
    img {
      max-width: 100%;
    }
    .sharing, .meta, .pager {
      margin: 20px 0px 20px 0px;
    }
    .page-footer p {
      text-align: center;
    }
  </style>
  <script src="/javascripts/libs/jquery.js"></script>
  <script src="/javascripts/libs/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/bootstrap.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script type="text/javascript" src="/javascripts/api.js"></script>
  <script type="text/javascript" src="/javascripts/wordcumulus.js"></script>
  <script type="text/javascript" src="/javascripts/swfobject.js"></script>
  <script type="text/javascript" src="/javascripts/tagcumulus.js"></script>
  <link href="/atom.xml" rel="alternate" title="小明明s à domicile" type="application/atom+xml">
  <script type="text/javascript" src="/javascripts/sh_python.min.js"></script>
<script type="text/javascript" src="/javascripts/sh_bash.min.js"></script>
<script type="text/javascript" src="/javascripts/sh_main.min.js"></script>
<link href="/stylesheets/sh_ide-anjuta.css" rel="stylesheet" type="text/css">

  
<script id="search-results-template" type="text/x-handlebars-template">
  {{#entries}}
    <article>
        <h3>
            <small><time datetime="{{date}}" pubdate>{{date}}</time></small>
            <a href="{{url}}">{{title}}</a>
            <p>tagged: {{ tags }} | category: <a href="/categories/{{category }}">{{category}}</a></p>
        </h3>
    </article>
  {{/entries}}
</script>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-20495125-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    onload="sh_highlightDocument('', '.js');">
<a href="http://github.com/dongweiming/">
<img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png" alt="Follower me on GitHub">
</a>
  <nav role="navigation"><div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a class="brand" href="/">小明明s à domicile</a>

      <div class="nav-collapse">
          <ul class="nav">
    <li><a href="/">博客主页</a></li>
    <li><a href="/blog/archives">文章列表</a></li>
    <li><a href="/aboutsite">关于本站</a></li>
    <li><a href="/projects">我的项目</a></li>
    <li><a href="http://dongweiming.github.io/sed_and_awk">sed_and_awk</a></li>
    <li><a href="http://dongweiming.github.io/Expert-Python">Expert-Python</a></li>
    <li><a href="/aboutme">关于我</a></li>
</ul>

          <ul class="nav pull-right" data-subscription="rss">
              <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
          
          </ul>

        

          
            <form action="/search" method="get" class="pull-right navbar-search">
    <fieldset role ="search">
        <input type="text" id="search-query" name="q" placeholder="Search" autocomplete="off" class="search" />
    </fieldset>
</form>

          
      </div>
    </div>
  </div>
</div>
</nav>
  <div class="container">
      <div class="row-fluid">
      <div class="span9">
  
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/linuxyunweibukebuzhidexingnengjiankonghediaoshigongju/">Linux运维不可不知的性能监控和调试工具（一）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-14T00:00:00+08:00" pubdate data-updated="true">Dec 14<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>前言：献给现在正在作运维或者立志作运维的朋友</strong></p>

<p><strong>sysstat组件，包含了：sar，iostat，mpstat，pidstat，nfsiostat 等命令</strong></p>

<p>wget http://pagesperso-orange.fr/sebastien.godard/sysstat-10.0.3.tar.gz
tar zxvf sysstat-10.0.3.tar.gz
cd sysstat-10.0.3/
./configure  &#8211;enable-install-cron &amp;&amp; make &amp;&amp; sudo make install</p>

<p><strong>1 sar 主要用来监控系统实时性能（CPU，内存，I / O等），以及在一个持续的基础上上，在后台性能数据收集并分析历史数据，以确定瓶颈问题</strong></p>

<p><strong> 1 所有CPU的CPU使用率</strong></p>

<p>dongwm@linux-b8lh:~/sysstat-10.0.3&gt; sar -u 1 3
Linux 2.6.37.6-0.7-default (linux-b8lh)     2011年12月14日     _i686_    (4 CPU)</p>

<p>09时23分00秒     CPU     %user     %nice   %system   %iowait    %steal     %idle
09时23分01秒     all     23.87      0.00      3.27      0.00      0.00     72.86
09时23分02秒     all     22.94      0.00      2.49      0.00      0.00     74.56
09时23分03秒     all     23.50      0.00      3.00      2.00      0.00     71.50
平均时间:     all     23.44      0.00      2.92      0.67      0.00     72.98
<ul>
	<li><strong>sar -u </strong>显示CPU使用率，目前每天收集到这一点。</li>
	<li><strong>sar -u 1 3</strong>显示实时CPU使用率每隔1秒,3次。</li>
	<li><strong>sar -u  ALL 1 3“</strong>和 “sar -u 1 3”相同，还显示了附加 ​​字段。</li>
	<li><strong></strong><strong>sar -u -f /var/log/sa/sa10 </strong><strong></strong>显示sa10文件中10天的CPU使用率。</li>
</ul>
<strong>2 单个CPU或核心的CPU使用率</strong></p>

<p>dongwm@linux-b8lh:~/sysstat-10.0.3&gt; sar -P ALL 1 1
Linux 2.6.37.6-0.7-default (linux-b8lh)     2011年12月14日     _i686_    (4 CPU)</p>

<p>09时27分08秒     CPU     %user     %nice   %system   %iowait    %steal     %idle
09时27分09秒     all     24.31      0.00      2.51      0.00      0.00     73.18
09时27分09秒       0     34.00      0.00      4.00      0.00      0.00     62.00
09时27分09秒       1     47.00      0.00      3.00      0.00      0.00     50.00
09时27分09秒       2     12.00      0.00      1.00      0.00      0.00     87.00
09时27分09秒       3      4.00      0.00      2.00      0.00      0.00     94.00</p>

<p>平均时间:     CPU     %user     %nice   %system   %iowait    %steal     %idle
平均时间:     all     24.31      0.00      2.51      0.00      0.00     73.18
平均时间:       0     34.00      0.00      4.00      0.00      0.00     62.00
平均时间:       1     47.00      0.00      3.00      0.00      0.00     50.00
平均时间:       2     12.00      0.00      1.00      0.00      0.00     87.00
<ul>
	<li><strong>sar -P ALL </strong>显示当天所有核心CPU使用率。</li>
	<li><strong>sar -P ALL 1 3 </strong>实时显示的时间为每1秒3次的所有核心的CPU使用率。</li>
	<li><strong>sar -P 1，</strong>显示当前日期的CPU数1使用。</li>
	<li><strong>sar- P 1 1 3</strong> 实时显示的时间为核心的数字1，每1秒3次的CPU使用率。</li>
	<li><strong>sar  -P ALL &#8211;f  / var/log/sa/sa10</strong>显示CPU使用率，和上面解释类似</li>
</ul>
<strong>3 内存使用和空闲</strong></p>

<p>dongwm@linux-b8lh:~/sysstat-10.0.3&gt; sar -r 1 3  ＃表示实时显示的时间为每1秒,3次的内存情况
Linux 2.6.37.6-0.7-default (linux-b8lh)     2011年12月14日     _i686_    (4 CPU)</p>

<p>09时31分59秒 kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact
09时32分00秒   1282240   1991048     60.83    189256    979120   2308156     42.93   1091840    771404
09时32分01秒   1284348   1988940     60.76    189256    979120   2304796     42.87   1089208    771404
09时32分02秒   1282364   1990924     60.82    189272    979112   2308156     42.93   1091828    771412
平均时间:   1282984   1990304     60.80    189261    979117   2307036     42.91   1090959    771407</p>

<p><strong>4 交换分区的使用情况</strong></p>

<p>dongwm@linux-b8lh:~/sysstat-10.0.3&gt; sar -S 1 3  ＃表示实时显示的时间为每1秒,3次的sawp使用情况
Linux 2.6.37.6-0.7-default (linux-b8lh)     2011年12月14日     _i686_    (4 CPU)</p>

<p>09时33分26秒 kbswpfree kbswpused  %swpused  kbswpcad   %swpcad
09时33分27秒   2011680     91612      4.36      3076      3.36
09时33分28秒   2011680     91612      4.36      3076      3.36
09时33分29秒   2011680     91612      4.36      3076      3.36
平均时间:   2011680     91612      4.36      3076      3.36</p>

<p><strong>5 I/O状态 ＃表示实时显示的时间为每1秒3次的I/O使用情况</strong></p>

<p>dongwm@linux-b8lh:~/sysstat-10.0.3&gt; sar -b 1 3
Linux 2.6.37.6-0.7-default (linux-b8lh)     2011年12月14日     _i686_    (4 CPU)</p>

<p>09时35分43秒       tps      rtps      wtps   bread/s   bwrtn/s
09时35分44秒      2.00      0.00      2.00      0.00     32.00
09时35分45秒     97.00      0.00     97.00      0.00   1192.00
09时35分46秒      6.00      0.00      6.00      0.00    144.00
平均时间:     35.00      0.00     35.00      0.00    456.00
<strong>6 单个dev设备的I／O状态</strong></p>

<p>dongwm@linux-b8lh:~/sysstat-10.0.3&gt; sar -d 1 3</p>

<p>注：也可以显示成sda，sdb这样的形式：</p>

<p>dongwm@linux-b8lh:~/sysstat-10.0.3&gt; sar -p -d 1 3
<strong>7 显示每秒的上下文切换</strong></p>

<p>dongwm@linux-b8lh:~/sysstat-10.0.3&gt; sar -w 1 3</p>

<p><strong>8 报告运行队列和平均负载(个人最喜欢)</strong></p>

<p>dongwm@linux-b8lh:~/sysstat-10.0.3&gt; sar -q 1 3
Linux 2.6.37.6-0.7-default (linux-b8lh)     2011年12月14日     _i686_    (4 CPU)</div>
  
  
    <footer>
      <a rel="full-article" href="/archives/linuxyunweibukebuzhidexingnengjiankonghediaoshigongju/">继续阅读 &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/pythonshiyongeccduisocketshujujiami/">python使用ECC对socket数据加密</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-08T00:00:00+08:00" pubdate data-updated="true">Dec 8<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前言：公网的数据交流自然需要加密以保证数据不被不合适的人看见。至于我为什么选择ECC，请参看:<a href="http://blog.163.com/aining_li@126/blog/static/67536753201162245932189/">RSA与ECC比较 </a></p>

<p>我这里使用了pyecc模块实现python的接口，但是需要一些依赖：<a href="http://point-at-infinity.org/seccure/">seccure</a>,而其也需要libgcrypt和libgcrypt-dev</p>

<p>1 安装<a href="http://point-at-infinity.org/seccure/">seccure</a>：</p>

<p>wget http://point-at-infinity.org/seccure/seccure-0.4.tar.gz
tar zxvf seccure-0.4.tar.gz
cd seccure-0.4 &amp;&amp; make &amp;&amp; sudo make install</p>

<p>2 安装pyecc：</p>

<p>git clone https://github.com/slideinc/PyECC.git
cd PyECC/
sudo python setup.py install</p>

<p>3 使用简介：</p>

<p>encrypts = pyecc.ECC.generate()</p>

<p>data ＝ encrypter.encrypt(&#8216;要加密的数据&#8217;)</p>

<p>encrypter.decrypt(data) #解密</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/linuxxiamonixshellscrtdezidongdengluduotaifuwuqicaozuominglingyijiduilinuxzhongduandeweizhikongzhi/">linux下模拟Xshell/Scrt的自动登录多台服务器操作命令以及对linux终端的位置控制</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-08T00:00:00+08:00" pubdate data-updated="true">Dec 8<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前言：windows下的终端登录软件xshell或者Scrt都有自动登录以及做组操作的功能，linux下好像cssh也能作类似的东西，我闲来体验了linux下类似的操作，简单的原理是expect+gnome终端：</p>

<p>请看我的主脚本：主要实现的是将testex脚本的SSH登录服务器ip修改，然后启动新终端，再执行expect脚本里面的内容，启动一个python脚本</p>

<p><pre class="sh_python">
dongwm@linux-b8lh:~&gt; cat term
import time
import os
cip = '192.168.1.6'
i = 0
list = ［'192.168.1.1','192.168.1.2','192.168.1.3','192.168.1.4','192.168.1.5','192.168.1.6'］
for ip in list:
    os.system('sed -i "s/%s/%s/" ~/testex' % (cip,ip))
    if i &lt;3:                     #这里的move其实就是终端在屏幕上的偏移量，我的屏幕分辨率是1440＊900,根据这个不同下面的值也不同，我设计的是桌面铺满6个，一行三个
        num = 480*i
        move = '58x20+%s+0' % num
    else:
        num = 480*(i-4)
        move = '58x20+%s+400' % num
    cmd = 'gnome-terminal --geometry=%s -e ~/testex' % move   #--geometry选项是窗体的长＊窗体的宽+左右偏移+上下偏移, opensuse默认的效果是80x24+200+200
    os.system(cmd)
    cip = ip
    print '%s done' % ip
    i +=1
    time.sleep(0.1)
</pre>
#这是一个expect脚本，语法参看我以前的文章：<a href="http://www.dongwm.com/archives/%e5%85%b3%e4%ba%8eexpect%e7%a0%94%e7%a9%b6%ef%bc%88%e4%ba%8c%ef%bc%89/" target="_blank">关于expect研究（二）</a>
<pre class="sh_tcl">
dongwm@linux-b8lh:~&gt; cat testex    
#!/usr/bin/expect
set timeout 10
set password 34wsetg6\(\#
spawn luit -encoding gbk ssh -p 61002 root@192.168.1.6
expect "#"
send "python /home/dongwm/RevSocket.py\n"
interact
</pre></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/pyqt4pythonchengxuqidonghuamiandanrudanchuxiaoguo/">(Pyqt4)python程序启动画面淡入淡出效果</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-04T00:00:00+08:00" pubdate data-updated="true">Nov 4<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前言：见过很多软件启动程序后会有个启动画面，并且还有个淡入淡出效果。研究了很久终于实现了：</p>

<p><pre class="sh_python">
class SplashScreen(QSplashScreen):</p>

<p>    def __init__(self):
        super(SplashScreen, self).__init__(QPixmap("../image/app.jpg"))   ＃启动程序的图片
        self.setWindowModality(Qt.ApplicationModal)
    def fadeTicker(self):
        self.setWindowOpacity(0) 
        t =0
        while t &lt;=50:
            newOpacity = self.windowOpacity() + 0.02     ＃设置淡入
            if newOpacity &gt; 1:
           #     self.close()
                break</p>

<p>            self.setWindowOpacity(newOpacity)
            self.show()
            t -= 1
            time.sleep(0.04)
        self.show()
        time.sleep(1)
        t =0
        while t &lt;=50:
            newOpacity = self.windowOpacity() - 0.02         ＃设置淡出
            if newOpacity &lt; 0:
                self.close()
                break</p>

<p>            self.setWindowOpacity(newOpacity)
            self.show()
            t += 1
            time.sleep(0.04)</p>

<p>if __name__ == "__main__":
    app = QtGui.QApplication(sys.argv)
    splash = SplashScreen()
    splash.fadeTicker()
    app.processEvents()   ＃设置启动画面不影响其他效果
    QtGui.QApplication.setQuitOnLastWindowClosed(False)          
    window = Window(confdict)       ＃这是qt程序的主类 每个人的这个不同
    window.st()
    splash.finish(window)            ＃启动画面完成启动qt主类
    sys.exit(app.exec_())
</pre></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/shiyongsuperviserangbuwendingchengxusidiaozidongmashangzhongqi/">使用supervise让不稳定程序死掉自动马上重启</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-03T00:00:00+08:00" pubdate data-updated="true">Nov 3<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前言：supervise是daemontools的一个工具，可以用来监控linux下程序的进程状态，当程序有一些问题（例如死掉）会根据设置 自动重启。我有一个socket服务器端需要一直监听数据，但是为了保证它不会莫名其妙的死掉而不可知，但是使用ICE(全称Internet Communications Engine)有点大材小用，所以使用了这个supervise自动重启死掉的程序并记录日志</p>

<p><strong>1 下载安装配置：</strong></p>

<p>wget http://cr.yp.to/daemontools/daemontools-0.76.tar.gz</p>

<p>wget http://www.qmail.org/moni.csi.hu/pub/glibc-2.3.1/daemontools-0.76.errno.patch  ＃这个补丁是修复有些操作系统无法编译安装成功，过程中会报错停止的问题</p>

<p>tar xvzf daemontools-0.76.tar.gz</p>

<p>cd admin/daemontools-0.76</p>

<p>patch -Np1 -i ../../daemontools-0.76.errno.patch</p>

<p>package/compile</p>

<p>cd package &amp;&amp;  sed &#8216;s|/command|/usr/sbin|&#8217; boot.inittab &gt; boot.inittab~</p>

<p>mv -f boot.inittab~ boot.inittab &amp;&amp;  cd ../command</p>

<p>sed -e &#8216;s/command:\/usr\/local\/bin:/usr\/local\/sbin:/&#8217;  -e &#8216;s/command\/svc/usr\/sbin\/svc/&#8217; svscanboot &gt; svscanboot~</p>

<p>mv -f svscanboot~ svscanboot &amp;&amp; chmod +x svscanboot</p>

<p>sudo /bin/cp * /usr/sbin</p>

<p>添加： SV:123456:respawn:/usr/sbin/svscanboot  到  /etc/inittab</p>

<p><strong>2 检查是否安装成功：</strong></p>

<p># pstree -p|grep svs ＃然后有下面类似的进程结构（括号中数据会不一样）</p>

<p>|-svscanboot(22011)-+-readproctitle(22014)         |</p>

<p>`-svscan(22013)</p>

<p><strong>3 编辑你要使用supervise的程序和配置文件</strong></p>

<p>首先建立一个目录：</p>

<p>mkdir /home/dongwm/SocketSrv</p>

<p>然后编辑run配置文件：</p>

<p>cat /home/dongwm/SocketSrv/run
#!/bin/sh
echo &#8216;kill Socketsrv&#8230;&#8217;
kill -9 `ps -ef |grep Socketsrv.py |grep -v grep |awk &#8216;{print $2}&#8217;`</p>

<p>echo &#8220;`date +%Y%m%d-%H%M%S`&#8221;
echo &#8216;start Socketsrv&#8230;&#8217;
python Socketsrv.py ＃这个就是你要让它关里的进程程序 就在Socketsrv目录下</p>

<p><strong>4 启动进程：</strong>
为了排错，我使用了日志记录＋日志轮转的方式（）</p>

<p>nohup supervise /home/dongwm/SocketSrv |/usr/sbin/cronolog &#8220;/var/log/Socketsrv.log_%Y%m%d&#8221; &amp;</p>

<p>表示后台运行，将输入定向到/var/log/Socketsrv.log 并且按天分日志
<strong></strong></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/shiyongcx_freezeduipengyoutahuanoni/">使用cx_Freeze对python程序打包生成多个exe文件</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-28T00:00:00+08:00" pubdate data-updated="true">Oct 28<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前言：使用python程序需要打包成exe忽略python环境的可执行文件，但是网上没有出现一个相对比较好的文档，我这里有一个setup.py:</p>

<p><pre class="sh_python">
from distutils.core import setup
from cx_Freeze import setup, Executable </p>

<p>GUI2Exe = Executable(
      script = "update.py",  ＃对主程序相关文件升级程序
      base = 'Win32GUI',
       )
GUI2Exe2 = Executable(
      script = "main.py",  #主程序
      base = 'Win32GUI',
      icon = r"C:\app.ico",  #自动exe文件的图标
      shortcutName = u"GY终端",  
       )
includeFiles = [
     ( r"C:\dervcer\etc", "../etc"),
     (r"C:\dervcer\log", "../log"),
      (r"C:\dervcer\image", "../image"),
      (r"C:\dervcer\imageformats", "./imageformats")
    ]   #这个地方主要是为了在打包中添加一些源文件，生成至打包目录，其中imageformats是pyqt4里面的插件动态链接库文件目录，要不然无法在winodws下显示系统图标</p>

<p>setup(
        name = "test",
        version = "0.1",
        description = "dongwm",   ＃生成的exe文件的描述
        options = {"build_exe": {"include_files": includeFiles,}}, </p>

<p>        executables = [GUI2Exe,GUI2Exe2])   ＃因为要生成多个exe文件 所以指定了2个执行的“块”
</pre></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/opensuseanzhuangkiba-dock/">Opensuse安装kiba-dock</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-27T00:00:00+08:00" pubdate data-updated="true">Oct 27<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前言：我想很多人都用过ubuntu下的cairo-dock，那么这个kiba－dock真的有点被遗忘，今天突然没事做，回忆了一下刚开始学习ubuntu时候的感觉。</p>

<p>目前opensuse新版本已经不含这个软件了。然后搜索了一下：</p>

<p>wget ftp://ftp.pbone.net/mirror/ftp5.gwdg.de/pub/opensuse/repositories/home:/swyear/openSUSE_11.1/i586/kiba-dock-0.svn862-6.6.i586.rpm
wget ftp://ftp.pbone.net/mirror/ftp5.gwdg.de/pub/opensuse/repositories/home:/swyear/openSUSE_11.1/i586/kiba-plugins-0.svn862-7.6.i586.rpm</p>

<p>但是发现：需要一个比较老的libcrypto.so.0.9.8和libssl.so.0.9.8，但是我的版本已经提高到1.0.0，所以安装时候忽略依赖关系
sudo rpm -ivh kiba-plugins-0.svn862-7.6.i586.rpm kiba-dock-0.svn862-6.6.i586.rpm &#8211;nodeps</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/jiejuepyqtxitongtuopanyoujiancaidanzaidianjiqitaweizhibuyincangxiaoshidewenti/">解决pyqt系统托盘右键菜单在点击其他位置不隐藏（消失）的问题</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-25T00:00:00+08:00" pubdate data-updated="true">Oct 25<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前言：在使用一些软件的时候都发现当你右键点开这个软件的菜单，再点击其他位置这个菜单会隐藏起来。这样不弹出的菜单无法消失，必须点击菜单项或者应用程序窗体才会消失。。pyqt软件也有这个问题。我研究了一下：该菜单的context是默认的应用程序窗体，当窗体获得焦点时，系统托盘的上下文菜单才会消失。</p>

<p>请看我的部分代码：</p>

<p>self.minimizeAction = QtGui.QAction(u&#8221;最小化&#8221;, self,
triggered=self.hide)   ＃这个self是继承QtGui.QMainWindow的类
self.restoreAction = QtGui.QAction(u&#8221;显示菜单&#8221;, self,
triggered=self.show)
self.quitAction = QtGui.QAction(u&#8221;退出&#8221;, self,
triggered=QtGui.qApp.quit)</p>

<p>self.trayIconMenu = QtGui.QMenu(self)
self.trayIconMenu.addAction(self.restoreAction)
self.trayIconMenu.addAction(self.minimizeAction)
self.trayIconMenu.addAction(self.quitAction)
需要将“self.trayIconMenu = QtGui.QMenu(self)”这行修改为“self.trayIconMenu = QtGui.QMenu(QtGui.QApplication.desktop())”  原理是将这个菜单当作一个桌面</p>

<p>&nbsp;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/pythonchengxubenlipyqt4tuxingchengxuzhongdianjizidongdanchuqqliaotianchuangkou/">python程序（本例pyqt4图形程序）中点击自动弹出QQ聊天窗口</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-24T00:00:00+08:00" pubdate data-updated="true">Oct 24<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前言：很向往点击某网页就能弹出QQ聊天窗口，最近做的一个python程序为了方便用户提交bug，也设计了一个点击自动弹出和我QQ聊天的对话框供大家参考（只剪切了其中一部分）：</p>

<p><pre class="sh_python"></p>

<p>from PyQt4 import QtCore, QtGui
import systray_rc
import threading,os
import re,time
try:
_fromUtf8 = QtCore.QString.fromUtf8
except AttributeError:
_fromUtf8 = lambda s: s
#设计一个界面，可以做成记事本效果，能够打印文件中的文本
class Ui_notepad(object):
def setupUi(self, notepad):
notepad.setObjectName(_fromUtf8("notepad"))
notepad.setWindowTitle(QtGui.QApplication.translate("notepad", "Form", None, QtGui.QApplication.UnicodeUTF8))
self.editor_window = QtGui.QTextEdit(notepad)
self.editor_window.setGeometry(QtCore.QRect(10, 50, 380, 240))
self.editor_window.setObjectName(_fromUtf8("editor_window"))</p>

<p>self.retranslateUi(notepad)
QtCore.QMetaObject.connectSlotsByName(notepad)</p>

<p>def retranslateUi(self, notepad):
pass
class Window(QtGui.QMainWindow):
    def __init__(self):
       # super(Window, self).__init__()
	QtGui.QMainWindow.__init__(self)
        self.iconComboBox = QtGui.QComboBox()
        self.iconComboBox.addItem(
            QtGui.QIcon('../image/app.jpg'), "Dmyz")
	#通知区域图标右键菜单设置,弹出的菜单的行为，包括退出，还原，最小化
        self.minimizeAction = QtGui.QAction(u"最小化", self,
                triggered=self.hide)
        self.restoreAction = QtGui.QAction(u"显示菜单", self,
                triggered=self.showNormal)
        self.quitAction = QtGui.QAction(u"退出", self,
                triggered=QtGui.qApp.quit)
	self.ui = Ui_notepad()
        self.ui.setupUi(self)
        self.trayIconMenu = QtGui.QMenu(self)
        self.trayIconMenu.addAction(self.restoreAction)
        self.trayIconMenu.addAction(self.minimizeAction)
        self.trayIconMenu.addAction(self.quitAction)
        self.trayIcon = QtGui.QSystemTrayIcon(self)
        self.trayIcon.setContextMenu(self.trayIconMenu)
        self.iconComboBox.currentIndexChanged.connect(
            self.setIcon)
        #设置第一个按键 效果退出
        exit = QtGui.QAction(QtGui.QIcon('../image/exit.png'), 'Exit', self)
	exit.setShortcut('Ctrl+Q')
        exit.setStatusTip(u'\u9000\u51fa\u4e3b\u83dc\u5355')
        self.connect(exit, QtCore.SIGNAL('triggered()'), QtCore.SLOT('close()'))
	#设置第二个按键  历史记录
        lishi = QtGui.QAction(QtGui.QIcon('../image/history.png'),u'\u5386\u53f2', self)
	lishi.setShortcut('Ctrl+L')
        lishi.setStatusTip(u'\u5386\u53f2')
        lishi.connect(lishi,QtCore.SIGNAL('triggered()'), self.file_dialog)
	#设置第3个按键  关于信息
	guangyu = QtGui.QAction(QtGui.QIcon('../image/app.jpg'),u'\u5173\u4e8e', self)
	guangyu.setShortcut('Ctrl+K')
        guangyu.setStatusTip(u'\u5173\u4e8e')
        guangyu.connect(guangyu,QtCore.SIGNAL('triggered()'), self.print_text)
	#设置第4个按键 bug提交 弹出QQ对话框
	qq = QtGui.QAction(QtGui.QIcon('../image/QQ.png'),u'BUG\u8bf7\u8054\u7cfb\u6211', self)
	qq.setShortcut('Ctrl+U')
        qq.setStatusTip(u'\u70b9\u51fb\u6253\u5f00QQ')
        qq.connect(qq,QtCore.SIGNAL('triggered()'), self.contqq)</p>

<p>        self.statusBar()
        menubar = self.menuBar()
        file = menubar.addMenu('&amp;Exit')
        file.addAction(exit)
	file2 = menubar.addMenu('&amp;History')
        file2.addAction(lishi)
	file3 = menubar.addMenu('About')
        file3.addAction(guangyu)
	file3 = menubar.addMenu('Contact')
        file3.addAction(qq)
    #设置打开文件 在pyqt4的主餐单里面的记事本区域显示
    def file_dialog(self):
        s = open('../log/Communicate.log','r').read()
	if len(s) == 0:
	    self.atext = u'目前您还没收到什么信息哦^.^'
	    self.ui.editor_window.setPlainText('sdf')
        self.ui.editor_window.setPlainText(self.atext)
    def print_text(self):  #设置打印关于的信息
	self.ui.editor_window.setPlainText(self.text)
    def contqq(self):  #设置打开QQ
	import win32com.client
	ie6=win32com.client.Dispatch("InternetExplorer.Application")
	ie6.Navigate("tencent://message/?exe=qq&amp;menu=yes&amp;Uin=61966225")
	ie6.Visible=1
	while ie6.Busy:
	  time.sleep(1)
</pre></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/archives/shiyongsvntexingshipythonchengxuzidonggengxin/">使用svn特性使python程序自动更新</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-23T00:00:00+08:00" pubdate data-updated="true">Oct 23<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前言：本例借用pysvn这个第三方模块实现。原理是对比某2个svn版本的不同的文件列表，根据增加，删除和修改的不同座不同的操作，达到程序的自动更新</p>

<p><pre class="sh_python">
class Svnup:
    def __init__(self,minv,maxv):
        import pysvn
        import getopt, sys, time, string
        import os, urllib
        from urlparse import urlparse
        client = pysvn.Client()
        revision_min = pysvn.Revision( pysvn.opt_revision_kind.number,minv)
        revision_max = pysvn.Revision( pysvn.opt_revision_kind.number,maxv)
        urlObject = urlparse('http://172.16.180.129/project/svnup')
        url = urlObject.scheme+"://"+urlObject.netloc+urllib.quote(urlObject.path.decode(sys.stdin.encoding).encode('utf8'))
    def get_login(self,realm, user, may_save ):
        return True,'dongwm','password', False
    def run(self):
        client.callback_get_login = get_login
        summary = client.diff_summarize(url, revision_min, url, revision_max)
        for changed in summary:
            print changed['summarize_kind']
            if pysvn.diff_summarize_kind.delete == changed['summarize_kind']:
              fullPath = "../"+changed['path']
              if os.path.exists(fullPath):
                os.remove(fullPath)</p>

<p>            if pysvn.diff_summarize_kind.added == changed['summarize_kind'] or pysvn.diff_summarize_kind.modified == changed['summarize_kind']:
                print changed['summarize_kind'], changed['path']
                if changed['node_kind'] == pysvn.node_kind.file:
                    file_text = client.cat(url+urllib.quote(changed['path'].encode('utf8')), revision_max)
                    fullPath = "../"+changed['path']
                    dirPath = fullPath[0:fullPath.rfind("/")]
                    if not os.path.exists(dirPath):
                        os.makedirs(dirPath)
                    f = open(fullPath,'wb')
                    f.write(file_text)
                    f.close
svnup =Svnup(svn-min,svn-max)
svnup.run()
</pre></p>
</div>
  
  


    </article>
  
  <ul class="pager">
    
    <li class="previous"><a href="/page/23/">&larr; Older</a></li>
    
    <li><a href="/blog/archives">博客文章</a></li>
    
    <li class="next"><a href="/page/21/">Newer &rarr;</a></li>
    
  </ul>
</div>
<aside class="sidebar-nav span3">
  
    <section class='well'>
    <ul id='qq' class='nav'>
        <li class='nav-header'>我新建了一个QQ群</li>
        <li style="padding-left: 15px;">121435120</li>
        <li style="padding-left: 15px;">欢迎入伙</li>
    </ul>
</section>
<section class="well">
  <ul id="recent_posts" class="nav nav-list">
    <li class="nav-header">最近发布</li>
    
      <li class="post">
        <a href="/archives/12ge-pythonnao-jin-ji-zhuan-wan/">12个python填空题</a>
      </li>
    
      <li class="post">
        <a href="/archives/wo-li-jie-de-pythonzui-jia-shi-jian/">我理解的python最佳实践</a>
      </li>
    
      <li class="post">
        <a href="/archives/pythonjin-jie-bi-du-hui-zong/">python进阶必读汇总</a>
      </li>
    
      <li class="post">
        <a href="/archives/liao-liao-pythonmian-shi-zhe-jian-shi-er/">聊聊python面试这件事儿</a>
      </li>
    
      <li class="post">
        <a href="/archives/idiomatic-python/">idiomatic python</a>
      </li>
    
      <li class="post">
        <a href="/archives/r-shang-chuan-wen-jian-fu-wu/">r - 上传文件服务</a>
      </li>
    
      <li class="post">
        <a href="/archives/dou-ban-tiao-mu-zu-zhao-pin/">[置顶]豆瓣条目组招聘-产品开发</a>
      </li>
    
      <li class="post">
        <a href="/archives/ast-xiang-lisp%5B%3F%5D-yang-zi-ding-yi-dai-ma-xing-wei/">AST - 像lisp一样自定义代码行为</a>
      </li>
    
      <li class="post">
        <a href="/archives/slack-alert-ba-ding-shi-ren-wu-de-jie-guo-fa-song-slackxiao-xi-de-wei-kuang-jia/">slack-alert - 把定时任务的结果发送slack消息的微框架</a>
      </li>
    
      <li class="post">
        <a href="/archives/slackshang-de-xiao-huang-ji-slackbot/">slack上的小黄鸡 - SlackBot</a>
      </li>
    
  </ul>
</section>
<section class="well">
  <ul id="recent_posts" class="nav nav-list">
  <li class="nav-header">个人网站</li>
    <li class="post"><a href="http://salogs.com">带我入行的boss</a></li>
    <li class="post"><a href="http://dongweiming.github.com/">小明明s Github Blog</a></li>
    <li class="post"><a href="http://youhouer.appspot.com/">Love story(GAE)</a></li>
    <li class="post"><a href="http://www.unixhot.com">unixhot运维社区</a></li>
    <li class="post"><a href="http://www.vpsee.com">Vpsee</a></li>
    <li class="post"><a href="http://dongweiming.github.io/sed_and_awk/">sed_and_awk</a></li>
    <li class="post"><a href="http://dongweiming.github.io/Expert-Python">Expert-Python</a></li>
  </ul>
</section>

<section class="well">
  <ul id="gh_repos" class="nav">
    <li class="nav-header">GitHub帐号</li>
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/dongweiming">@dongweiming</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        github.showRepos({
            user: 'dongweiming',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/asides/github.js" type="text/javascript"> </script>
</section>




<section class="well">
   <ul id="gh_repos" class="nav">
    <li class="nav-header">标签Cloud</li>
  </ul>
  <div id="tag-cloud"></div>
</section>

<section class="well">
  <ul id="gh_repos" class="nav">
    <li class="nav-header">豆瓣阅读</li>
  </ul>
  <script type="text/javascript" src="http://www.douban.com/service/badge/62943420/?select=random&amp;n=10&amp;columns=2&amp;picsize=medium&amp;hidelogo=true&amp;hideself=true&amp;cat=book|music" ></script>
  <a href="https://www.douban.com/people/62943420">@小明明</a> on Douban 
</section>


<section class='well'>
<ul id='gh_repos' class='nav'>
<li class='nav-header'>文章统计</li>
<li>本站共有 271 篇文章</li>
</ul>
</section>


  
</aside>

      </div>
  </div>
  <footer role="contentinfo" class="page-footer"><hr>
<p>
  Copyright &copy; 2015 - Dongweiming -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dongwm';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
